/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/ngx-mat-timepicker-adapter.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __assign } from "tslib";
import { NgxMatTimepickerFormat } from "../models/ngx-mat-timepicker-format.enum";
import { NgxMatTimepickerPeriods } from "../models/ngx-mat-timepicker-periods.enum";
//
import { DateTime } from "ts-luxon";
// @dynamic
var NgxMatTimepickerAdapter = /** @class */ (function () {
    function NgxMatTimepickerAdapter() {
    }
    /***
     *  Format hour according to time format (12 or 24)
     */
    /**
     *
     *  Format hour according to time format (12 or 24)
     * @param {?} currentHour
     * @param {?} format
     * @param {?} period
     * @return {?}
     */
    NgxMatTimepickerAdapter.formatHour = /**
     *
     *  Format hour according to time format (12 or 24)
     * @param {?} currentHour
     * @param {?} format
     * @param {?} period
     * @return {?}
     */
    function (currentHour, format, period) {
        if (format === 24) {
            return currentHour;
        }
        /** @type {?} */
        var hour = period === NgxMatTimepickerPeriods.AM ? currentHour : currentHour + 12;
        if (period === NgxMatTimepickerPeriods.AM && hour === 12) {
            return 0;
        }
        else if (period === NgxMatTimepickerPeriods.PM && hour === 24) {
            return 12;
        }
        return hour;
    };
    /**
     * @param {?} time
     * @param {?} opts
     * @return {?}
     */
    NgxMatTimepickerAdapter.formatTime = /**
     * @param {?} time
     * @param {?} opts
     * @return {?}
     */
    function (time, opts) {
        if (!time) {
            return "Invalid Time";
        }
        var format = opts.format;
        /** @type {?} */
        var parsedTime = NgxMatTimepickerAdapter.parseTime(time, opts).setLocale(NgxMatTimepickerAdapter.defaultLocale);
        if (format !== 24) {
            return parsedTime.toLocaleString(__assign(__assign({}, DateTime.TIME_SIMPLE), { hour12: format !== 24 })).replace(/\u200E/g, "");
        }
        return parsedTime.toISOTime({
            includeOffset: false,
            suppressMilliseconds: true,
            suppressSeconds: true
        }).replace(/\u200E/g, "");
    };
    /**
     * @param {?} time
     * @param {?} format
     * @return {?}
     */
    NgxMatTimepickerAdapter.fromDateTimeToString = /**
     * @param {?} time
     * @param {?} format
     * @return {?}
     */
    function (time, format) {
        /** @type {?} */
        var timeFormat = format === 24 ? NgxMatTimepickerFormat.TWENTY_FOUR : NgxMatTimepickerFormat.TWELVE;
        return time.reconfigure({
            numberingSystem: NgxMatTimepickerAdapter.defaultNumberingSistem,
            locale: NgxMatTimepickerAdapter.defaultLocale
        }).toFormat(timeFormat);
    };
    /**
     * @param {?} time
     * @param {?} before
     * @param {?} after
     * @param {?=} unit
     * @return {?}
     */
    NgxMatTimepickerAdapter.isBetween = /**
     * @param {?} time
     * @param {?} before
     * @param {?} after
     * @param {?=} unit
     * @return {?}
     */
    function (time, before, after, unit) {
        if (unit === void 0) { unit = "minutes"; }
        if (unit === "hours") {
            return this.isSameOrBefore(time, after, unit) && this.isSameOrAfter(time, before, unit);
        }
        if (unit === "minutes") {
            return this.isSameOrBefore(time, after) && this.isSameOrAfter(time, before);
        }
    };
    /**
     * @param {?} time
     * @param {?} compareWith
     * @param {?=} unit
     * @return {?}
     */
    NgxMatTimepickerAdapter.isSameOrAfter = /**
     * @param {?} time
     * @param {?} compareWith
     * @param {?=} unit
     * @return {?}
     */
    function (time, compareWith, unit) {
        if (unit === void 0) { unit = "minutes"; }
        if (unit === "hours") {
            return time.hour >= compareWith.hour;
        }
        if (unit === "minutes") {
            return time.hasSame(compareWith, unit) || time.valueOf() > compareWith.valueOf();
        }
    };
    /**
     * @param {?} time
     * @param {?} compareWith
     * @param {?=} unit
     * @return {?}
     */
    NgxMatTimepickerAdapter.isSameOrBefore = /**
     * @param {?} time
     * @param {?} compareWith
     * @param {?=} unit
     * @return {?}
     */
    function (time, compareWith, unit) {
        if (unit === void 0) { unit = "minutes"; }
        if (unit === "hours") {
            return time.hour <= compareWith.hour;
        }
        if (unit === "minutes") {
            return time.hasSame(compareWith, unit) || time.valueOf() <= compareWith.valueOf();
        }
    };
    /**
     * @param {?} time
     * @param {?=} min
     * @param {?=} max
     * @param {?=} granularity
     * @param {?=} minutesGap
     * @param {?=} format
     * @return {?}
     */
    NgxMatTimepickerAdapter.isTimeAvailable = /**
     * @param {?} time
     * @param {?=} min
     * @param {?=} max
     * @param {?=} granularity
     * @param {?=} minutesGap
     * @param {?=} format
     * @return {?}
     */
    function (time, min, max, granularity, minutesGap, format) {
        if (!time) {
            return;
        }
        /** @type {?} */
        var convertedTime = this.parseTime(time, { format: format });
        /** @type {?} */
        var minutes = convertedTime.minute;
        if (minutesGap && minutes === minutes && minutes % minutesGap !== 0) {
            throw new Error("Your minutes - " + minutes + " doesn't match your minutesGap - " + minutesGap);
        }
        /** @type {?} */
        var isAfter = (min && !max)
            && this.isSameOrAfter(convertedTime, min, granularity);
        /** @type {?} */
        var isBefore = (max && !min)
            && this.isSameOrBefore(convertedTime, max, granularity);
        /** @type {?} */
        var between = (min && max)
            && this.isBetween(convertedTime, min, max, granularity);
        /** @type {?} */
        var isAvailable = !min && !max;
        return isAfter || isBefore || between || isAvailable;
    };
    /**
     * @param {?} time
     * @param {?} opts
     * @return {?}
     */
    NgxMatTimepickerAdapter.parseTime = /**
     * @param {?} time
     * @param {?} opts
     * @return {?}
     */
    function (time, opts) {
        var _a = NgxMatTimepickerAdapter._getLocaleOptionsByTime(time, opts), numberingSystem = _a.numberingSystem, locale = _a.locale;
        /** @type {?} */
        var isPeriodExist = time.split(" ").length === 2;
        /** @type {?} */
        var timeMask = isPeriodExist ? NgxMatTimepickerFormat.TWELVE_SHORT : NgxMatTimepickerFormat.TWENTY_FOUR_SHORT;
        return DateTime.fromFormat(time, timeMask, { numberingSystem: numberingSystem, locale: locale });
    };
    /**
     * @param {?} time
     * @param {?=} opts
     * @return {?}
     */
    NgxMatTimepickerAdapter.toLocaleTimeString = /**
     * @param {?} time
     * @param {?=} opts
     * @return {?}
     */
    function (time, opts) {
        if (opts === void 0) { opts = {}; }
        var _a = opts.format, format = _a === void 0 ? NgxMatTimepickerAdapter.defaultFormat : _a, _b = opts.locale, locale = _b === void 0 ? NgxMatTimepickerAdapter.defaultLocale : _b;
        /** @type {?} */
        var hourCycle = format === 24 ? "h23" : "h12";
        /** @type {?} */
        var timeFormat = __assign(__assign({}, DateTime.TIME_SIMPLE), { hourCycle: hourCycle });
        /** @type {?} */
        var timeMask = (format === 24) ? NgxMatTimepickerFormat.TWENTY_FOUR_SHORT : NgxMatTimepickerFormat.TWELVE_SHORT;
        return DateTime.fromFormat(time, timeMask).setLocale(locale).toLocaleString(timeFormat);
    };
    /**
     * @private
     * @param {?} time
     * @param {?} opts
     * @return {?}
     */
    NgxMatTimepickerAdapter._getLocaleOptionsByTime = /**
     * @private
     * @param {?} time
     * @param {?} opts
     * @return {?}
     */
    function (time, opts) {
        var _a = DateTime.local().setLocale(opts.locale).resolvedLocaleOpts(), numberingSystem = _a.numberingSystem, locale = _a.locale;
        /** @type {?} */
        var localeConfig = {
            numberingSystem: (/** @type {?} */ (numberingSystem)),
            locale: locale
        };
        /** @type {?} */
        var defaultConfig = {
            numberingSystem: NgxMatTimepickerAdapter.defaultNumberingSistem,
            locale: NgxMatTimepickerAdapter.defaultLocale
        };
        return isNaN(parseInt(time, 10)) ? localeConfig : defaultConfig;
    };
    NgxMatTimepickerAdapter.defaultFormat = 12;
    NgxMatTimepickerAdapter.defaultLocale = "en-US";
    NgxMatTimepickerAdapter.defaultNumberingSistem = "latn";
    return NgxMatTimepickerAdapter;
}());
export { NgxMatTimepickerAdapter };
if (false) {
    /** @type {?} */
    NgxMatTimepickerAdapter.defaultFormat;
    /** @type {?} */
    NgxMatTimepickerAdapter.defaultLocale;
    /** @type {?} */
    NgxMatTimepickerAdapter.defaultNumberingSistem;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC10aW1lcGlja2VyLWFkYXB0ZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtbWF0LXRpbWVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbmd4LW1hdC10aW1lcGlja2VyLWFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFDLHNCQUFzQixFQUFDLE1BQU0sMENBQTBDLENBQUM7QUFDaEYsT0FBTyxFQUFDLHVCQUF1QixFQUFDLE1BQU0sMkNBQTJDLENBQUM7O0FBR2xGLE9BQU8sRUFBQyxRQUFRLEVBQWlDLE1BQU0sVUFBVSxDQUFDOztBQUdsRTtJQUFBO0lBMklBLENBQUM7SUFySUc7O09BRUc7Ozs7Ozs7OztJQUNJLGtDQUFVOzs7Ozs7OztJQUFqQixVQUFrQixXQUFtQixFQUFFLE1BQWMsRUFBRSxNQUErQjtRQUNsRixJQUFJLE1BQU0sS0FBSyxFQUFFLEVBQUU7WUFDZixPQUFPLFdBQVcsQ0FBQztTQUN0Qjs7WUFDSyxJQUFJLEdBQUcsTUFBTSxLQUFLLHVCQUF1QixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLEdBQUcsRUFBRTtRQUVuRixJQUFJLE1BQU0sS0FBSyx1QkFBdUIsQ0FBQyxFQUFFLElBQUksSUFBSSxLQUFLLEVBQUUsRUFBRTtZQUN0RCxPQUFPLENBQUMsQ0FBQztTQUNaO2FBQ0ksSUFBSSxNQUFNLEtBQUssdUJBQXVCLENBQUMsRUFBRSxJQUFJLElBQUksS0FBSyxFQUFFLEVBQUU7WUFDM0QsT0FBTyxFQUFFLENBQUM7U0FDYjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Ozs7OztJQUVNLGtDQUFVOzs7OztJQUFqQixVQUFrQixJQUFZLEVBQUUsSUFBNkI7UUFDekQsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNQLE9BQU8sY0FBYyxDQUFDO1NBQ3pCO1FBQ00sSUFBQSxNQUFNLEdBQUksSUFBSSxPQUFSOztZ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QyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGtCQUFrQixFQUFFLEVBQXZGLGVBQWUscUJBQUEsRUFBRSxNQUFNLFlBQWdFOztZQUN4RixZQUFZLEdBQWtCO1lBQ2hDLGVBQWUsRUFBRSxtQkFBQSxlQUFlLEVBQW1CO1lBQ25ELE1BQU0sUUFBQTtTQUNUOztZQUNLLGFBQWEsR0FBa0I7WUFDakMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLHNCQUFzQjtZQUMvRCxNQUFNLEVBQUUsdUJBQXVCLENBQUMsYUFBYTtTQUNoRDtRQUVELE9BQU8sS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUM7SUFDcEUsQ0FBQztJQXhJTSxxQ0FBYSxHQUFHLEVBQUUsQ0FBQztJQUNuQixxQ0FBYSxHQUFHLE9BQU8sQ0FBQztJQUN4Qiw4Q0FBc0IsR0FBb0IsTUFBTSxDQUFDO0lBdUk1RCw4QkFBQztDQUFBLEFBM0lELElBMklDO1NBM0lZLHVCQUF1Qjs7O0lBRWhDLHNDQUEwQjs7SUFDMUIsc0NBQStCOztJQUMvQiwrQ0FBd0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge05neE1hdFRpbWVwaWNrZXJGb3JtYXR9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLWZvcm1hdC5lbnVtXCI7XG5pbXBvcnQge05neE1hdFRpbWVwaWNrZXJQZXJpb2RzfSBmcm9tIFwiLi4vbW9kZWxzL25neC1tYXQtdGltZXBpY2tlci1wZXJpb2RzLmVudW1cIjtcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlck9wdGlvbnN9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLW9wdGlvbnMuaW50ZXJmYWNlXCI7XG4vL1xuaW1wb3J0IHtEYXRlVGltZSwgTG9jYWxlT3B0aW9ucywgTnVtYmVyaW5nU3lzdGVtfSBmcm9tIFwidHMtbHV4b25cIjtcblxuLy8gQGR5bmFtaWNcbmV4cG9ydCBjbGFzcyBOZ3hNYXRUaW1lcGlja2VyQWRhcHRlciB7XG5cbiAgICBzdGF0aWMgZGVmYXVsdEZvcm1hdCA9IDEyO1xuICAgIHN0YXRpYyBkZWZhdWx0TG9jYWxlID0gXCJlbi1VU1wiO1xuICAgIHN0YXRpYyBkZWZhdWx0TnVtYmVyaW5nU2lzdGVtOiBOdW1iZXJpbmdTeXN0ZW0gPSBcImxhdG5cIjtcblxuICAgIC8qKipcbiAgICAgKiAgRm9ybWF0IGhvdXIgYWNjb3JkaW5nIHRvIHRpbWUgZm9ybWF0ICgxMiBvciAyNClcbiAgICAgKi9cbiAgICBzdGF0aWMgZm9ybWF0SG91cihjdXJyZW50SG91cjogbnVtYmVyLCBmb3JtYXQ6IG51bWJlciwgcGVyaW9kOiBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcyk6IG51bWJlciB7XG4gICAgICAgIGlmIChmb3JtYXQgPT09IDI0KSB7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudEhvdXI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaG91ciA9IHBlcmlvZCA9PT0gTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU0gPyBjdXJyZW50SG91ciA6IGN1cnJlbnRIb3VyICsgMTI7XG5cbiAgICAgICAgaWYgKHBlcmlvZCA9PT0gTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU0gJiYgaG91ciA9PT0gMTIpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHBlcmlvZCA9PT0gTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuUE0gJiYgaG91ciA9PT0gMjQpIHtcbiAgICAgICAgICAgIHJldHVybiAxMjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBob3VyO1xuICAgIH1cblxuICAgIHN0YXRpYyBmb3JtYXRUaW1lKHRpbWU6IHN0cmluZywgb3B0czogTmd4TWF0VGltZXBpY2tlck9wdGlvbnMpOiBzdHJpbmcge1xuICAgICAgICBpZiAoIXRpbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBcIkludmFsaWQgVGltZVwiO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHtmb3JtYXR9ID0gb3B0cztcbiAgICAgICAgY29uc3QgcGFyc2VkVGltZSA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLnBhcnNlVGltZSh0aW1lLCBvcHRzKS5zZXRMb2NhbGUoTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIuZGVmYXVsdExvY2FsZSk7XG5cbiAgICAgICAgaWYgKGZvcm1hdCAhPT0gMjQpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZWRUaW1lLnRvTG9jYWxlU3RyaW5nKHtcbiAgICAgICAgICAgICAgICAuLi5EYXRlVGltZS5USU1FX1NJTVBMRSxcbiAgICAgICAgICAgICAgICBob3VyMTI6IGZvcm1hdCAhPT0gMjRcbiAgICAgICAgICAgIH0pLnJlcGxhY2UoL1xcdTIwMEUvZywgXCJcIik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGFyc2VkVGltZS50b0lTT1RpbWUoe1xuICAgICAgICAgICAgaW5jbHVkZU9mZnNldDogZmFsc2UsXG4gICAgICAgICAgICBzdXBwcmVzc01pbGxpc2Vjb25kczogdHJ1ZSxcbiAgICAgICAgICAgIHN1cHByZXNzU2Vjb25kczogdHJ1ZVxuICAgICAgICB9KS5yZXBsYWNlKC9cXHUyMDBFL2csIFwiXCIpO1xuICAgIH1cblxuICAgIHN0YXRpYyBmcm9tRGF0ZVRpbWVUb1N0cmluZyh0aW1lOiBEYXRlVGltZSwgZm9ybWF0OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCB0aW1lRm9ybWF0ID0gZm9ybWF0ID09PSAyNCA/IE5neE1hdFRpbWVwaWNrZXJGb3JtYXQuVFdFTlRZX0ZPVVIgOiBOZ3hNYXRUaW1lcGlja2VyRm9ybWF0LlRXRUxWRTtcblxuICAgICAgICByZXR1cm4gdGltZS5yZWNvbmZpZ3VyZSh7XG4gICAgICAgICAgICBudW1iZXJpbmdTeXN0ZW06IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmRlZmF1bHROdW1iZXJpbmdTaXN0ZW0sXG4gICAgICAgICAgICBsb2NhbGU6IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmRlZmF1bHRMb2NhbGVcbiAgICAgICAgfSkudG9Gb3JtYXQodGltZUZvcm1hdCk7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzQmV0d2Vlbih0aW1lOiBEYXRlVGltZSwgYmVmb3JlOiBEYXRlVGltZSwgYWZ0ZXI6IERhdGVUaW1lLCB1bml0OiBcImhvdXJzXCIgfCBcIm1pbnV0ZXNcIiA9IFwibWludXRlc1wiKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh1bml0ID09PSBcImhvdXJzXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzU2FtZU9yQmVmb3JlKHRpbWUsIGFmdGVyLCB1bml0KSAmJiB0aGlzLmlzU2FtZU9yQWZ0ZXIodGltZSwgYmVmb3JlLCB1bml0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodW5pdCA9PT0gXCJtaW51dGVzXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzU2FtZU9yQmVmb3JlKHRpbWUsIGFmdGVyKSAmJiB0aGlzLmlzU2FtZU9yQWZ0ZXIodGltZSwgYmVmb3JlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBpc1NhbWVPckFmdGVyKHRpbWU6IERhdGVUaW1lLCBjb21wYXJlV2l0aDogRGF0ZVRpbWUsIHVuaXQ6IFwiaG91cnNcIiB8IFwibWludXRlc1wiID0gXCJtaW51dGVzXCIpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHVuaXQgPT09IFwiaG91cnNcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRpbWUuaG91ciA+PSBjb21wYXJlV2l0aC5ob3VyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1bml0ID09PSBcIm1pbnV0ZXNcIikge1xuICAgICAgICAgICAgcmV0dXJuIHRpbWUuaGFzU2FtZShjb21wYXJlV2l0aCwgdW5pdCkgfHwgdGltZS52YWx1ZU9mKCkgPiBjb21wYXJlV2l0aC52YWx1ZU9mKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgaXNTYW1lT3JCZWZvcmUodGltZTogRGF0ZVRpbWUsIGNvbXBhcmVXaXRoOiBEYXRlVGltZSwgdW5pdDogXCJob3Vyc1wiIHwgXCJtaW51dGVzXCIgPSBcIm1pbnV0ZXNcIik6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodW5pdCA9PT0gXCJob3Vyc1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGltZS5ob3VyIDw9IGNvbXBhcmVXaXRoLmhvdXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVuaXQgPT09IFwibWludXRlc1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGltZS5oYXNTYW1lKGNvbXBhcmVXaXRoLCB1bml0KSB8fCB0aW1lLnZhbHVlT2YoKSA8PSBjb21wYXJlV2l0aC52YWx1ZU9mKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgaXNUaW1lQXZhaWxhYmxlKHRpbWU6IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbj86IERhdGVUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4PzogRGF0ZVRpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBncmFudWxhcml0eT86IFwiaG91cnNcIiB8IFwibWludXRlc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlc0dhcD86IG51bWJlciB8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ/OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKCF0aW1lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb252ZXJ0ZWRUaW1lID0gdGhpcy5wYXJzZVRpbWUodGltZSwge2Zvcm1hdH0pO1xuICAgICAgICBjb25zdCBtaW51dGVzID0gY29udmVydGVkVGltZS5taW51dGU7XG5cbiAgICAgICAgaWYgKG1pbnV0ZXNHYXAgJiYgbWludXRlcyA9PT0gbWludXRlcyAmJiBtaW51dGVzICUgbWludXRlc0dhcCAhPT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBZb3VyIG1pbnV0ZXMgLSAke21pbnV0ZXN9IGRvZXNuXFwndCBtYXRjaCB5b3VyIG1pbnV0ZXNHYXAgLSAke21pbnV0ZXNHYXB9YCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNBZnRlciA9IChtaW4gJiYgIW1heClcbiAgICAgICAgICAgICYmIHRoaXMuaXNTYW1lT3JBZnRlcihjb252ZXJ0ZWRUaW1lLCBtaW4sIGdyYW51bGFyaXR5KTtcbiAgICAgICAgY29uc3QgaXNCZWZvcmUgPSAobWF4ICYmICFtaW4pXG4gICAgICAgICAgICAmJiB0aGlzLmlzU2FtZU9yQmVmb3JlKGNvbnZlcnRlZFRpbWUsIG1heCwgZ3JhbnVsYXJpdHkpO1xuICAgICAgICBjb25zdCBiZXR3ZWVuID0gKG1pbiAmJiBtYXgpXG4gICAgICAgICAgICAmJiB0aGlzLmlzQmV0d2Vlbihjb252ZXJ0ZWRUaW1lLCBtaW4sIG1heCwgZ3JhbnVsYXJpdHkpO1xuICAgICAgICBjb25zdCBpc0F2YWlsYWJsZSA9ICFtaW4gJiYgIW1heDtcblxuICAgICAgICByZXR1cm4gaXNBZnRlciB8fCBpc0JlZm9yZSB8fCBiZXR3ZWVuIHx8IGlzQXZhaWxhYmxlO1xuICAgIH1cblxuICAgIHN0YXRpYyBwYXJzZVRpbWUodGltZTogc3RyaW5nLCBvcHRzOiBOZ3hNYXRUaW1lcGlja2VyT3B0aW9ucyk6IERhdGVUaW1lIHtcbiAgICAgICAgY29uc3Qge251bWJlcmluZ1N5c3RlbSwgbG9jYWxlfSA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLl9nZXRMb2NhbGVPcHRpb25zQnlUaW1lKHRpbWUsIG9wdHMpO1xuICAgICAgICBjb25zdCBpc1BlcmlvZEV4aXN0ID0gdGltZS5zcGxpdChcIiBcIikubGVuZ3RoID09PSAyO1xuICAgICAgICBjb25zdCB0aW1lTWFzayA9IGlzUGVyaW9kRXhpc3QgPyBOZ3hNYXRUaW1lcGlja2VyRm9ybWF0LlRXRUxWRV9TSE9SVCA6IE5neE1hdFRpbWVwaWNrZXJGb3JtYXQuVFdFTlRZX0ZPVVJfU0hPUlQ7XG5cbiAgICAgICAgcmV0dXJuIERhdGVUaW1lLmZyb21Gb3JtYXQodGltZSwgdGltZU1hc2ssIHtudW1iZXJpbmdTeXN0ZW0sIGxvY2FsZX0pO1xuICAgIH1cblxuICAgIHN0YXRpYyB0b0xvY2FsZVRpbWVTdHJpbmcodGltZTogc3RyaW5nLCBvcHRzOiBOZ3hNYXRUaW1lcGlja2VyT3B0aW9ucyA9IHt9KTogc3RyaW5nIHtcbiAgICAgICAgY29uc3Qge2Zvcm1hdCA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmRlZmF1bHRGb3JtYXQsIGxvY2FsZSA9IE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmRlZmF1bHRMb2NhbGV9ID0gb3B0cztcbiAgICAgICAgY29uc3QgaG91ckN5Y2xlID0gZm9ybWF0ID09PSAyNCA/IFwiaDIzXCIgOiBcImgxMlwiO1xuICAgICAgICBjb25zdCB0aW1lRm9ybWF0ID0gey4uLkRhdGVUaW1lLlRJTUVfU0lNUExFLCBob3VyQ3ljbGV9O1xuICAgICAgICBjb25zdCB0aW1lTWFzayA9IChmb3JtYXQgPT09IDI0KSA/IE5neE1hdFRpbWVwaWNrZXJGb3JtYXQuVFdFTlRZX0ZPVVJfU0hPUlQgOiBOZ3hNYXRUaW1lcGlja2VyRm9ybWF0LlRXRUxWRV9TSE9SVDtcblxuICAgICAgICByZXR1cm4gRGF0ZVRpbWUuZnJvbUZvcm1hdCh0aW1lLCB0aW1lTWFzaykuc2V0TG9jYWxlKGxvY2FsZSkudG9Mb2NhbGVTdHJpbmcodGltZUZvcm1hdCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgX2dldExvY2FsZU9wdGlvbnNCeVRpbWUodGltZTogc3RyaW5nLCBvcHRzOiBOZ3hNYXRUaW1lcGlja2VyT3B0aW9ucyk6IExvY2FsZU9wdGlvbnMge1xuICAgICAgICBjb25zdCB7bnVtYmVyaW5nU3lzdGVtLCBsb2NhbGV9ID0gRGF0ZVRpbWUubG9jYWwoKS5zZXRMb2NhbGUob3B0cy5sb2NhbGUpLnJlc29sdmVkTG9jYWxlT3B0cygpO1xuICAgICAgICBjb25zdCBsb2NhbGVDb25maWc6IExvY2FsZU9wdGlvbnMgPSB7XG4gICAgICAgICAgICBudW1iZXJpbmdTeXN0ZW06IG51bWJlcmluZ1N5c3RlbSBhcyBOdW1iZXJpbmdTeXN0ZW0sXG4gICAgICAgICAgICBsb2NhbGVcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZGVmYXVsdENvbmZpZzogTG9jYWxlT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG51bWJlcmluZ1N5c3RlbTogTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIuZGVmYXVsdE51bWJlcmluZ1Npc3RlbSxcbiAgICAgICAgICAgIGxvY2FsZTogTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIuZGVmYXVsdExvY2FsZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBpc05hTihwYXJzZUludCh0aW1lLCAxMCkpID8gbG9jYWxlQ29uZmlnIDogZGVmYXVsdENvbmZpZztcbiAgICB9XG59XG4iXX0=