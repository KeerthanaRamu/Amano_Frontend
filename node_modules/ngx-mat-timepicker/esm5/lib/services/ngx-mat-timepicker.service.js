/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/ngx-mat-timepicker.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __assign } from "tslib";
import { Injectable } from "@angular/core";
import { BehaviorSubject } from "rxjs";
import { NgxMatTimepickerPeriods } from "../models/ngx-mat-timepicker-periods.enum";
import { NgxMatTimepickerAdapter } from "./ngx-mat-timepicker-adapter";
import { DateTime } from "ts-luxon";
import * as i0 from "@angular/core";
/** @type {?} */
var DEFAULT_HOUR = {
    time: 12,
    angle: 360
};
/** @type {?} */
var DEFAULT_MINUTE = {
    time: 0,
    angle: 360
};
var NgxMatTimepickerService = /** @class */ (function () {
    function NgxMatTimepickerService() {
        this._hour$ = new BehaviorSubject(DEFAULT_HOUR);
        this._minute$ = new BehaviorSubject(DEFAULT_MINUTE);
        this._period$ = new BehaviorSubject(NgxMatTimepickerPeriods.AM);
    }
    Object.defineProperty(NgxMatTimepickerService.prototype, "hour", {
        set: /**
         * @param {?} hour
         * @return {?}
         */
        function (hour) {
            this._hour$.next(hour);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(NgxMatTimepickerService.prototype, "minute", {
        set: /**
         * @param {?} minute
         * @return {?}
         */
        function (minute) {
            this._minute$.next(minute);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(NgxMatTimepickerService.prototype, "period", {
        set: /**
         * @param {?} period
         * @return {?}
         */
        function (period) {
            /** @type {?} */
            var isPeriodValid = (period === NgxMatTimepickerPeriods.AM) || (period === NgxMatTimepickerPeriods.PM);
            if (isPeriodValid) {
                this._period$.next(period);
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(NgxMatTimepickerService.prototype, "selectedHour", {
        get: /**
         * @return {?}
         */
        function () {
            return this._hour$.asObservable();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(NgxMatTimepickerService.prototype, "selectedMinute", {
        get: /**
         * @return {?}
         */
        function () {
            return this._minute$.asObservable();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(NgxMatTimepickerService.prototype, "selectedPeriod", {
        get: /**
         * @return {?}
         */
        function () {
            return this._period$.asObservable();
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @param {?} format
     * @return {?}
     */
    NgxMatTimepickerService.prototype.getFullTime = /**
     * @param {?} format
     * @return {?}
     */
    function (format) {
        /** @type {?} */
        var selectedHour = this._hour$.getValue().time;
        /** @type {?} */
        var selectedMinute = this._minute$.getValue().time;
        /** @type {?} */
        var hour = selectedHour != null ? selectedHour : DEFAULT_HOUR.time;
        /** @type {?} */
        var minute = selectedMinute != null ? selectedMinute : DEFAULT_MINUTE.time;
        /** @type {?} */
        var period = format === 12 ? this._period$.getValue() : "";
        /** @type {?} */
        var time = (hour + ":" + minute + " " + period).trim();
        return NgxMatTimepickerAdapter.formatTime(time, { format: format });
    };
    /**
     * @param {?} time
     * @param {?} min
     * @param {?} max
     * @param {?} format
     * @param {?=} minutesGap
     * @return {?}
     */
    NgxMatTimepickerService.prototype.setDefaultTimeIfAvailable = /**
     * @param {?} time
     * @param {?} min
     * @param {?} max
     * @param {?} format
     * @param {?=} minutesGap
     * @return {?}
     */
    function (time, min, max, format, minutesGap) {
        /* Workaround to double error message*/
        try {
            if (NgxMatTimepickerAdapter.isTimeAvailable(time, min, max, "minutes", minutesGap)) {
                this._setDefaultTime(time, format);
            }
        }
        catch (e) {
            console.error(e);
        }
    };
    /**
     * @private
     * @return {?}
     */
    NgxMatTimepickerService.prototype._resetTime = /**
     * @private
     * @return {?}
     */
    function () {
        this.hour = __assign({}, DEFAULT_HOUR);
        this.minute = __assign({}, DEFAULT_MINUTE);
        this.period = NgxMatTimepickerPeriods.AM;
    };
    /**
     * @private
     * @param {?} time
     * @param {?} format
     * @return {?}
     */
    NgxMatTimepickerService.prototype._setDefaultTime = /**
     * @private
     * @param {?} time
     * @param {?} format
     * @return {?}
     */
    function (time, format) {
        /** @type {?} */
        var defaultTime = NgxMatTimepickerAdapter.parseTime(time, { format: format }).toJSDate();
        // Check on null, because invalid date will be null
        if (DateTime.fromJSDate(defaultTime) !== null) {
            /** @type {?} */
            var period = time.substr(time.length - 2).toUpperCase();
            /** @type {?} */
            var hour = defaultTime.getHours();
            this.hour = __assign(__assign({}, DEFAULT_HOUR), { time: formatHourByPeriod(hour, (/** @type {?} */ (period))) });
            this.minute = __assign(__assign({}, DEFAULT_MINUTE), { time: defaultTime.getMinutes() });
            this.period = (/** @type {?} */ (period));
        }
        else {
            this._resetTime();
        }
    };
    NgxMatTimepickerService.decorators = [
        { type: Injectable, args: [{
                    providedIn: "root"
                },] }
    ];
    /** @nocollapse */ NgxMatTimepickerService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgxMatTimepickerService_Factory() { return new NgxMatTimepickerService(); }, token: NgxMatTimepickerService, providedIn: "root" });
    return NgxMatTimepickerService;
}());
export { NgxMatTimepickerService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgxMatTimepickerService.prototype._hour$;
    /**
     * @type {?}
     * @private
     */
    NgxMatTimepickerService.prototype._minute$;
    /**
     * @type {?}
     * @private
     */
    NgxMatTimepickerService.prototype._period$;
}
/**
 *
 *  Format hour in 24hours format to meridian (AM or PM) format
 * @param {?} hour
 * @param {?} period
 * @return {?}
 */
function formatHourByPeriod(hour, period) {
    switch (period) {
        case NgxMatTimepickerPeriods.AM:
            return hour === 0 ? 12 : hour;
        case NgxMatTimepickerPeriods.PM:
            return hour === 12 ? 12 : hour - 12;
        default:
            return hour;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC10aW1lcGlja2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtbWF0LXRpbWVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbmd4LW1hdC10aW1lcGlja2VyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV6QyxPQUFPLEVBQUMsZUFBZSxFQUFhLE1BQU0sTUFBTSxDQUFDO0FBQ2pELE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLDJDQUEyQyxDQUFDO0FBQ2xGLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQ3JFLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxVQUFVLENBQUM7OztJQUU1QixZQUFZLEdBQThCO0lBQzVDLElBQUksRUFBRSxFQUFFO0lBQ1IsS0FBSyxFQUFFLEdBQUc7Q0FDYjs7SUFDSyxjQUFjLEdBQThCO0lBQzlDLElBQUksRUFBRSxDQUFDO0lBQ1AsS0FBSyxFQUFFLEdBQUc7Q0FDYjtBQUVEO0lBQUE7UUFrQ1ksV0FBTSxHQUFHLElBQUksZUFBZSxDQUE0QixZQUFZLENBQUMsQ0FBQztRQUN0RSxhQUFRLEdBQUcsSUFBSSxlQUFlLENBQTRCLGNBQWMsQ0FBQyxDQUFDO1FBQzFFLGFBQVEsR0FBRyxJQUFJLGVBQWUsQ0FBMEIsdUJBQXVCLENBQUMsRUFBRSxDQUFDLENBQUM7S0FnRC9GO0lBOUVHLHNCQUFJLHlDQUFJOzs7OztRQUFSLFVBQVMsSUFBK0I7WUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwyQ0FBTTs7Ozs7UUFBVixVQUFXLE1BQWlDO1lBQ3hDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9CLENBQUM7OztPQUFB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QyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRTs7Z0JBQ25ELElBQUksR0FBRyxXQUFXLENBQUMsUUFBUSxFQUFFO1lBRW5DLElBQUksQ0FBQyxJQUFJLHlCQUFPLFlBQVksS0FBRSxJQUFJLEVBQUUsa0JBQWtCLENBQUMsSUFBSSxFQUFFLG1CQUFBLE1BQU0sRUFBMkIsQ0FBQyxHQUFDLENBQUM7WUFDakcsSUFBSSxDQUFDLE1BQU0seUJBQU8sY0FBYyxLQUFFLElBQUksRUFBRSxXQUFXLENBQUMsVUFBVSxFQUFFLEdBQUMsQ0FBQztZQUNsRSxJQUFJLENBQUMsTUFBTSxHQUFHLG1CQUFBLE1BQU0sRUFBMkIsQ0FBQztTQUVuRDthQUNJO1lBQ0QsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQ3JCO0lBQ0wsQ0FBQzs7Z0JBbkZKLFVBQVUsU0FBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7OztrQ0FsQkQ7Q0FvR0MsQUFwRkQsSUFvRkM7U0FqRlksdUJBQXVCOzs7Ozs7SUErQmhDLHlDQUE4RTs7Ozs7SUFDOUUsMkNBQWtGOzs7OztJQUNsRiwyQ0FBNEY7Ozs7Ozs7OztBQXFEaEcsU0FBUyxrQkFBa0IsQ0FBQyxJQUFZLEVBQUUsTUFBK0I7SUFDckUsUUFBUSxNQUFNLEVBQUU7UUFDWixLQUFLLHVCQUF1QixDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNsQyxLQUFLLHVCQUF1QixDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDeEM7WUFDSSxPQUFPLElBQUksQ0FBQztLQUNuQjtBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGV9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge05neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2V9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLWNsb2NrLWZhY2UuaW50ZXJmYWNlXCI7XG5pbXBvcnQge0JlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZX0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlclBlcmlvZHN9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLXBlcmlvZHMuZW51bVwiO1xuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyQWRhcHRlcn0gZnJvbSBcIi4vbmd4LW1hdC10aW1lcGlja2VyLWFkYXB0ZXJcIjtcbmltcG9ydCB7RGF0ZVRpbWV9IGZyb20gXCJ0cy1sdXhvblwiO1xuXG5jb25zdCBERUZBVUxUX0hPVVI6IE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2UgPSB7XG4gICAgdGltZTogMTIsXG4gICAgYW5nbGU6IDM2MFxufTtcbmNvbnN0IERFRkFVTFRfTUlOVVRFOiBOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlID0ge1xuICAgIHRpbWU6IDAsXG4gICAgYW5nbGU6IDM2MFxufTtcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46IFwicm9vdFwiXG59KVxuZXhwb3J0IGNsYXNzIE5neE1hdFRpbWVwaWNrZXJTZXJ2aWNlIHtcblxuXG4gICAgc2V0IGhvdXIoaG91cjogTmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZSkge1xuICAgICAgICB0aGlzLl9ob3VyJC5uZXh0KGhvdXIpO1xuICAgIH1cblxuICAgIHNldCBtaW51dGUobWludXRlOiBOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlKSB7XG4gICAgICAgIHRoaXMuX21pbnV0ZSQubmV4dChtaW51dGUpO1xuICAgIH1cblxuICAgIHNldCBwZXJpb2QocGVyaW9kOiBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcykge1xuICAgICAgICBjb25zdCBpc1BlcmlvZFZhbGlkID0gKHBlcmlvZCA9PT0gTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU0pIHx8IChwZXJpb2QgPT09IE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzLlBNKTtcblxuICAgICAgICBpZiAoaXNQZXJpb2RWYWxpZCkge1xuICAgICAgICAgICAgdGhpcy5fcGVyaW9kJC5uZXh0KHBlcmlvZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgc2VsZWN0ZWRIb3VyKCk6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5faG91ciQuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgZ2V0IHNlbGVjdGVkTWludXRlKCk6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWludXRlJC5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBnZXQgc2VsZWN0ZWRQZXJpb2QoKTogT2JzZXJ2YWJsZTxOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcz4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGVyaW9kJC5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9ob3VyJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4oREVGQVVMVF9IT1VSKTtcbiAgICBwcml2YXRlIF9taW51dGUkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlPihERUZBVUxUX01JTlVURSk7XG4gICAgcHJpdmF0ZSBfcGVyaW9kJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tmd4TWF0VGltZXBpY2tlclBlcmlvZHM+KE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzLkFNKTtcblxuICAgIGdldEZ1bGxUaW1lKGZvcm1hdDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRIb3VyID0gdGhpcy5faG91ciQuZ2V0VmFsdWUoKS50aW1lO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1pbnV0ZSA9IHRoaXMuX21pbnV0ZSQuZ2V0VmFsdWUoKS50aW1lO1xuICAgICAgICBjb25zdCBob3VyID0gc2VsZWN0ZWRIb3VyICE9IG51bGwgPyBzZWxlY3RlZEhvdXIgOiBERUZBVUxUX0hPVVIudGltZTtcbiAgICAgICAgY29uc3QgbWludXRlID0gc2VsZWN0ZWRNaW51dGUgIT0gbnVsbCA/IHNlbGVjdGVkTWludXRlIDogREVGQVVMVF9NSU5VVEUudGltZTtcbiAgICAgICAgY29uc3QgcGVyaW9kID0gZm9ybWF0ID09PSAxMiA/IHRoaXMuX3BlcmlvZCQuZ2V0VmFsdWUoKSA6IFwiXCI7XG4gICAgICAgIGNvbnN0IHRpbWUgPSBgJHtob3VyfToke21pbnV0ZX0gJHtwZXJpb2R9YC50cmltKCk7XG5cbiAgICAgICAgcmV0dXJuIE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmZvcm1hdFRpbWUodGltZSwge2Zvcm1hdH0pO1xuICAgIH1cblxuXG4gICAgc2V0RGVmYXVsdFRpbWVJZkF2YWlsYWJsZSh0aW1lOiBzdHJpbmcsIG1pbjogRGF0ZVRpbWUsIG1heDogRGF0ZVRpbWUsIGZvcm1hdDogbnVtYmVyLCBtaW51dGVzR2FwPzogbnVtYmVyKSB7XG4gICAgICAgIC8qIFdvcmthcm91bmQgdG8gZG91YmxlIGVycm9yIG1lc3NhZ2UqL1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmlzVGltZUF2YWlsYWJsZSh0aW1lLCBtaW4sIG1heCwgXCJtaW51dGVzXCIsIG1pbnV0ZXNHYXApKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFRpbWUodGltZSwgZm9ybWF0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3Jlc2V0VGltZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ob3VyID0gey4uLkRFRkFVTFRfSE9VUn07XG4gICAgICAgIHRoaXMubWludXRlID0gey4uLkRFRkFVTFRfTUlOVVRFfTtcbiAgICAgICAgdGhpcy5wZXJpb2QgPSBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5BTTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9zZXREZWZhdWx0VGltZSh0aW1lOiBzdHJpbmcsIGZvcm1hdDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRUaW1lID0gTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIucGFyc2VUaW1lKHRpbWUsIHtmb3JtYXR9KS50b0pTRGF0ZSgpO1xuXG4gICAgICAgIC8vIENoZWNrIG9uIG51bGwsIGJlY2F1c2UgaW52YWxpZCBkYXRlIHdpbGwgYmUgbnVsbFxuICAgICAgICBpZiAoRGF0ZVRpbWUuZnJvbUpTRGF0ZShkZWZhdWx0VGltZSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHBlcmlvZCA9IHRpbWUuc3Vic3RyKHRpbWUubGVuZ3RoIC0gMikudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGhvdXIgPSBkZWZhdWx0VGltZS5nZXRIb3VycygpO1xuXG4gICAgICAgICAgICB0aGlzLmhvdXIgPSB7Li4uREVGQVVMVF9IT1VSLCB0aW1lOiBmb3JtYXRIb3VyQnlQZXJpb2QoaG91ciwgcGVyaW9kIGFzIE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzKX07XG4gICAgICAgICAgICB0aGlzLm1pbnV0ZSA9IHsuLi5ERUZBVUxUX01JTlVURSwgdGltZTogZGVmYXVsdFRpbWUuZ2V0TWludXRlcygpfTtcbiAgICAgICAgICAgIHRoaXMucGVyaW9kID0gcGVyaW9kIGFzIE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzO1xuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9yZXNldFRpbWUoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqKlxuICogIEZvcm1hdCBob3VyIGluIDI0aG91cnMgZm9ybWF0IHRvIG1lcmlkaWFuIChBTSBvciBQTSkgZm9ybWF0XG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEhvdXJCeVBlcmlvZChob3VyOiBudW1iZXIsIHBlcmlvZDogTmd4TWF0VGltZXBpY2tlclBlcmlvZHMpOiBudW1iZXIge1xuICAgIHN3aXRjaCAocGVyaW9kKSB7XG4gICAgICAgIGNhc2UgTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU06XG4gICAgICAgICAgICByZXR1cm4gaG91ciA9PT0gMCA/IDEyIDogaG91cjtcbiAgICAgICAgY2FzZSBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5QTTpcbiAgICAgICAgICAgIHJldHVybiBob3VyID09PSAxMiA/IDEyIDogaG91ciAtIDEyO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGhvdXI7XG4gICAgfVxufVxuIl19