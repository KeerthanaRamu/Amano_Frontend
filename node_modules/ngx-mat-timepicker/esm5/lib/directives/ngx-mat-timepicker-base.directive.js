/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/ngx-mat-timepicker-base.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, HostListener, Inject, Input, Optional } from "@angular/core";
//
import { NgxMatTimepickerEventService } from "../services/ngx-mat-timepicker-event.service";
import { NgxMatTimepickerService } from "../services/ngx-mat-timepicker.service";
import { NgxMatTimepickerAdapter } from "../services/ngx-mat-timepicker-adapter";
//
import { NgxMatTimepickerUnits } from "../models/ngx-mat-timepicker-units.enum";
import { NGX_MAT_TIMEPICKER_LOCALE } from "../tokens/ngx-mat-timepicker-time-locale.token";
import { NGX_MAT_TIMEPICKER_CONFIG } from "../tokens/ngx-mat-timepicker-config.token";
//
import { Subject } from "rxjs";
import { shareReplay, takeUntil } from "rxjs/operators";
var NgxMatTimepickerBaseDirective = /** @class */ (function () {
    function NgxMatTimepickerBaseDirective(_timepickerSrv, _eventSrv, _locale, data) {
        this._timepickerSrv = _timepickerSrv;
        this._eventSrv = _eventSrv;
        this._locale = _locale;
        this.data = data;
        this.activeTimeUnit = NgxMatTimepickerUnits.HOUR;
        this.timeUnit = NgxMatTimepickerUnits;
        this._color = "primary";
        this._subsCtrl$ = new Subject();
        this.color = data.color;
        this.defaultTime = data.defaultTime;
    }
    Object.defineProperty(NgxMatTimepickerBaseDirective.prototype, "color", {
        get: /**
         * @return {?}
         */
        function () {
            return this._color;
        },
        set: /**
         * @param {?} newValue
         * @return {?}
         */
        function (newValue) {
            this._color = newValue;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(NgxMatTimepickerBaseDirective.prototype, "defaultTime", {
        get: /**
         * @return {?}
         */
        function () {
            return this._defaultTime;
        },
        set: /**
         * @param {?} time
         * @return {?}
         */
        function (time) {
            this._defaultTime = time;
            this._setDefaultTime(time);
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @param {?} period
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.changePeriod = /**
     * @param {?} period
     * @return {?}
     */
    function (period) {
        this._timepickerSrv.period = period;
        this._onTimeChange();
    };
    /**
     * @param {?} unit
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.changeTimeUnit = /**
     * @param {?} unit
     * @return {?}
     */
    function (unit) {
        this.activeTimeUnit = unit;
    };
    /**
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.close = /**
     * @return {?}
     */
    function () {
        this.data.timepickerBaseRef.close();
    };
    /**
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._subsCtrl$.next();
        this._subsCtrl$.complete();
    };
    /**
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this._defineTime();
        this.selectedHour = this._timepickerSrv.selectedHour
            .pipe(shareReplay({ bufferSize: 1, refCount: true }));
        this.selectedMinute = this._timepickerSrv.selectedMinute
            .pipe(shareReplay({ bufferSize: 1, refCount: true }));
        this.selectedPeriod = this._timepickerSrv.selectedPeriod
            .pipe(shareReplay({ bufferSize: 1, refCount: true }));
        this.data.timepickerBaseRef.timeUpdated.pipe(takeUntil(this._subsCtrl$))
            .subscribe(this._setDefaultTime.bind(this));
    };
    /**
     * @param {?} hour
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.onHourChange = /**
     * @param {?} hour
     * @return {?}
     */
    function (hour) {
        this._timepickerSrv.hour = hour;
        this._onTimeChange();
    };
    /**
     * @param {?} hour
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.onHourSelected = /**
     * @param {?} hour
     * @return {?}
     */
    function (hour) {
        if (!this.data.hoursOnly) {
            this.changeTimeUnit(NgxMatTimepickerUnits.MINUTE);
        }
        this.data.timepickerBaseRef.hourSelected.next(hour);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.onKeydown = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this._eventSrv.dispatchEvent(e);
        e.stopPropagation();
    };
    /**
     * @param {?} minute
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.onMinuteChange = /**
     * @param {?} minute
     * @return {?}
     */
    function (minute) {
        this._timepickerSrv.minute = minute;
        this._onTimeChange();
    };
    /**
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype.setTime = /**
     * @return {?}
     */
    function () {
        this.data.timepickerBaseRef.timeSet.next(this._timepickerSrv.getFullTime(this.data.format));
        this.close();
    };
    /**
     * @protected
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype._defineTime = /**
     * @protected
     * @return {?}
     */
    function () {
        /** @type {?} */
        var minTime = this.data.minTime;
        if (minTime && (!this.data.time && !this.data.defaultTime)) {
            /** @type {?} */
            var time = NgxMatTimepickerAdapter.fromDateTimeToString(minTime, this.data.format);
            this._setDefaultTime(time);
        }
    };
    /**
     * @protected
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype._onTimeChange = /**
     * @protected
     * @return {?}
     */
    function () {
        /** @type {?} */
        var time = NgxMatTimepickerAdapter.toLocaleTimeString(this._timepickerSrv.getFullTime(this.data.format), {
            locale: this._locale,
            format: this.data.format
        });
        this.data.timepickerBaseRef.timeChanged.emit(time);
    };
    /**
     * @protected
     * @param {?} time
     * @return {?}
     */
    NgxMatTimepickerBaseDirective.prototype._setDefaultTime = /**
     * @protected
     * @param {?} time
     * @return {?}
     */
    function (time) {
        this._timepickerSrv.setDefaultTimeIfAvailable(time, this.data.minTime, this.data.maxTime, this.data.format, this.data.minutesGap);
    };
    NgxMatTimepickerBaseDirective.decorators = [
        { type: Directive, args: [{
                    selector: "[ngxMatTimepickerBase]"
                },] }
    ];
    /** @nocollapse */
    NgxMatTimepickerBaseDirective.ctorParameters = function () { return [
        { type: NgxMatTimepickerService },
        { type: NgxMatTimepickerEventService },
        { type: String, decorators: [{ type: Inject, args: [NGX_MAT_TIMEPICKER_LOCALE,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [NGX_MAT_TIMEPICKER_CONFIG,] }, { type: Optional }] }
    ]; };
    NgxMatTimepickerBaseDirective.propDecorators = {
        color: [{ type: Input }],
        defaultTime: [{ type: Input }],
        onKeydown: [{ type: HostListener, args: ["keydown", ["$event"],] }]
    };
    return NgxMatTimepickerBaseDirective;
}());
export { NgxMatTimepickerBaseDirective };
if (false) {
    /** @type {?} */
    NgxMatTimepickerBaseDirective.prototype.activeTimeUnit;
    /** @type {?} */
    NgxMatTimepickerBaseDirective.prototype.selectedHour;
    /** @type {?} */
    NgxMatTimepickerBaseDirective.prototype.selectedMinute;
    /** @type {?} */
    NgxMatTimepickerBaseDirective.prototype.selectedPeriod;
    /** @type {?} */
    NgxMatTimepickerBaseDirective.prototype.timeUnit;
    /**
     * @type {?}
     * @protected
     */
    NgxMatTimepickerBaseDirective.prototype._color;
    /**
     * @type {?}
     * @protected
     */
    NgxMatTimepickerBaseDirective.prototype._defaultTime;
    /**
     * @type {?}
     * @protected
     */
    NgxMatTimepickerBaseDirective.prototype._subsCtrl$;
    /**
     * @type {?}
     * @protected
     */
    NgxMatTimepickerBaseDirective.prototype._timepickerSrv;
    /**
     * @type {?}
     * @protected
     */
    NgxMatTimepickerBaseDirective.prototype._eventSrv;
    /**
     * @type {?}
     * @protected
     */
    NgxMatTimepickerBaseDirective.prototype._locale;
    /** @type {?} */
    NgxMatTimepickerBaseDirective.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC10aW1lcGlja2VyLWJhc2UuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LW1hdC10aW1lcGlja2VyLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvbmd4LW1hdC10aW1lcGlja2VyLWJhc2UuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBcUIsUUFBUSxFQUFDLE1BQU0sZUFBZSxDQUFDOztBQUdsRyxPQUFPLEVBQUMsNEJBQTRCLEVBQUMsTUFBTSw4Q0FBOEMsQ0FBQztBQUMxRixPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSx3Q0FBd0MsQ0FBQztBQUMvRSxPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSx3Q0FBd0MsQ0FBQzs7QUFFL0UsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0seUNBQXlDLENBQUM7QUFHOUUsT0FBTyxFQUFDLHlCQUF5QixFQUFDLE1BQU0sZ0RBQWdELENBQUM7QUFDekYsT0FBTyxFQUFDLHlCQUF5QixFQUFDLE1BQU0sMkNBQTJDLENBQUM7O0FBRXBGLE9BQU8sRUFBYSxPQUFPLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDekMsT0FBTyxFQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RDtJQWtDSSx1Q0FBc0IsY0FBdUMsRUFDdkMsU0FBdUMsRUFDSixPQUFlLEVBQ04sSUFBSTtRQUhoRCxtQkFBYyxHQUFkLGNBQWMsQ0FBeUI7UUFDdkMsY0FBUyxHQUFULFNBQVMsQ0FBOEI7UUFDSixZQUFPLEdBQVAsT0FBTyxDQUFRO1FBQ04sU0FBSSxHQUFKLElBQUksQ0FBQTtRQWJ0RSxtQkFBYyxHQUEwQixxQkFBcUIsQ0FBQyxJQUFJLENBQUM7UUFJbkUsYUFBUSxHQUFpQyxxQkFBcUIsQ0FBQztRQUVyRCxXQUFNLEdBQWlCLFNBQVMsQ0FBQztR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T25EZXN0cm95LCBPbkluaXQsIE9wdGlvbmFsfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtUaGVtZVBhbGV0dGV9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC9jb3JlXCI7XG4vL1xuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyRXZlbnRTZXJ2aWNlfSBmcm9tIFwiLi4vc2VydmljZXMvbmd4LW1hdC10aW1lcGlja2VyLWV2ZW50LnNlcnZpY2VcIjtcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlclNlcnZpY2V9IGZyb20gXCIuLi9zZXJ2aWNlcy9uZ3gtbWF0LXRpbWVwaWNrZXIuc2VydmljZVwiO1xuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyQWRhcHRlcn0gZnJvbSBcIi4uL3NlcnZpY2VzL25neC1tYXQtdGltZXBpY2tlci1hZGFwdGVyXCI7XG4vL1xuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyVW5pdHN9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLXVuaXRzLmVudW1cIjtcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZX0gZnJvbSBcIi4uL21vZGVscy9uZ3gtbWF0LXRpbWVwaWNrZXItY2xvY2stZmFjZS5pbnRlcmZhY2VcIjtcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlclBlcmlvZHN9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLXBlcmlvZHMuZW51bVwiO1xuaW1wb3J0IHtOR1hfTUFUX1RJTUVQSUNLRVJfTE9DQUxFfSBmcm9tIFwiLi4vdG9rZW5zL25neC1tYXQtdGltZXBpY2tlci10aW1lLWxvY2FsZS50b2tlblwiO1xuaW1wb3J0IHtOR1hfTUFUX1RJTUVQSUNLRVJfQ09ORklHfSBmcm9tIFwiLi4vdG9rZW5zL25neC1tYXQtdGltZXBpY2tlci1jb25maWcudG9rZW5cIjtcbi8vXG5pbXBvcnQge09ic2VydmFibGUsIFN1YmplY3R9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQge3NoYXJlUmVwbGF5LCB0YWtlVW50aWx9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xuXG5ARGlyZWN0aXZlKHtcbiAgICBzZWxlY3RvcjogXCJbbmd4TWF0VGltZXBpY2tlckJhc2VdXCJcbn0pXG5leHBvcnQgY2xhc3MgTmd4TWF0VGltZXBpY2tlckJhc2VEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCBjb2xvcihuZXdWYWx1ZTogVGhlbWVQYWxldHRlKSB7XG4gICAgICAgIHRoaXMuX2NvbG9yID0gbmV3VmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IGNvbG9yKCk6IFRoZW1lUGFsZXR0ZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb2xvcjtcbiAgICB9XG5cbiAgICBnZXQgZGVmYXVsdFRpbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRUaW1lO1xuICAgIH1cblxuICAgIEBJbnB1dCgpXG4gICAgc2V0IGRlZmF1bHRUaW1lKHRpbWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLl9kZWZhdWx0VGltZSA9IHRpbWU7XG4gICAgICAgIHRoaXMuX3NldERlZmF1bHRUaW1lKHRpbWUpO1xuICAgIH1cblxuICAgIGFjdGl2ZVRpbWVVbml0OiBOZ3hNYXRUaW1lcGlja2VyVW5pdHMgPSBOZ3hNYXRUaW1lcGlja2VyVW5pdHMuSE9VUjtcbiAgICBzZWxlY3RlZEhvdXI6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT47XG4gICAgc2VsZWN0ZWRNaW51dGU6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT47XG4gICAgc2VsZWN0ZWRQZXJpb2Q6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlclBlcmlvZHM+O1xuICAgIHRpbWVVbml0OiB0eXBlb2YgTmd4TWF0VGltZXBpY2tlclVuaXRzID0gTmd4TWF0VGltZXBpY2tlclVuaXRzO1xuXG4gICAgcHJvdGVjdGVkIF9jb2xvcjogVGhlbWVQYWxldHRlID0gXCJwcmltYXJ5XCI7XG4gICAgcHJvdGVjdGVkIF9kZWZhdWx0VGltZTogc3RyaW5nO1xuICAgIHByb3RlY3RlZCBfc3Vic0N0cmwkID0gbmV3IFN1YmplY3QoKTtcblxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBfdGltZXBpY2tlclNydjogTmd4TWF0VGltZXBpY2tlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIF9ldmVudFNydjogTmd4TWF0VGltZXBpY2tlckV2ZW50U2VydmljZSxcbiAgICAgICAgICAgICAgICBASW5qZWN0KE5HWF9NQVRfVElNRVBJQ0tFUl9MT0NBTEUpIHByb3RlY3RlZCBfbG9jYWxlOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgQEluamVjdChOR1hfTUFUX1RJTUVQSUNLRVJfQ09ORklHKSBAT3B0aW9uYWwoKSBwdWJsaWMgZGF0YSkge1xuXG4gICAgICAgIHRoaXMuY29sb3IgPSBkYXRhLmNvbG9yO1xuICAgICAgICB0aGlzLmRlZmF1bHRUaW1lID0gZGF0YS5kZWZhdWx0VGltZTtcbiAgICB9XG5cbiAgICBjaGFuZ2VQZXJpb2QocGVyaW9kOiBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcyk6IHZvaWQge1xuICAgICAgICB0aGlzLl90aW1lcGlja2VyU3J2LnBlcmlvZCA9IHBlcmlvZDtcbiAgICAgICAgdGhpcy5fb25UaW1lQ2hhbmdlKCk7XG4gICAgfVxuXG4gICAgY2hhbmdlVGltZVVuaXQodW5pdDogTmd4TWF0VGltZXBpY2tlclVuaXRzKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWN0aXZlVGltZVVuaXQgPSB1bml0O1xuICAgIH1cblxuICAgIGNsb3NlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmRhdGEudGltZXBpY2tlckJhc2VSZWYuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fc3Vic0N0cmwkLm5leHQoKTtcbiAgICAgICAgdGhpcy5fc3Vic0N0cmwkLmNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2RlZmluZVRpbWUoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEhvdXIgPSB0aGlzLl90aW1lcGlja2VyU3J2LnNlbGVjdGVkSG91clxuICAgICAgICAgICAgLnBpcGUoc2hhcmVSZXBsYXkoe2J1ZmZlclNpemU6IDEsIHJlZkNvdW50OiB0cnVlfSkpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkTWludXRlID0gdGhpcy5fdGltZXBpY2tlclNydi5zZWxlY3RlZE1pbnV0ZVxuICAgICAgICAgICAgLnBpcGUoc2hhcmVSZXBsYXkoe2J1ZmZlclNpemU6IDEsIHJlZkNvdW50OiB0cnVlfSkpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkUGVyaW9kID0gdGhpcy5fdGltZXBpY2tlclNydi5zZWxlY3RlZFBlcmlvZFxuICAgICAgICAgICAgLnBpcGUoc2hhcmVSZXBsYXkoe2J1ZmZlclNpemU6IDEsIHJlZkNvdW50OiB0cnVlfSkpO1xuICAgICAgICB0aGlzLmRhdGEudGltZXBpY2tlckJhc2VSZWYudGltZVVwZGF0ZWQucGlwZSh0YWtlVW50aWwodGhpcy5fc3Vic0N0cmwkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUodGhpcy5fc2V0RGVmYXVsdFRpbWUuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgb25Ib3VyQ2hhbmdlKGhvdXI6IE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2UpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fdGltZXBpY2tlclNydi5ob3VyID0gaG91cjtcbiAgICAgICAgdGhpcy5fb25UaW1lQ2hhbmdlKCk7XG4gICAgfVxuXG4gICAgb25Ib3VyU2VsZWN0ZWQoaG91cjogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5kYXRhLmhvdXJzT25seSkge1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VUaW1lVW5pdChOZ3hNYXRUaW1lcGlja2VyVW5pdHMuTUlOVVRFKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRhdGEudGltZXBpY2tlckJhc2VSZWYuaG91clNlbGVjdGVkLm5leHQoaG91cik7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcihcImtleWRvd25cIiwgW1wiJGV2ZW50XCJdKVxuICAgIG9uS2V5ZG93bihlOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fZXZlbnRTcnYuZGlzcGF0Y2hFdmVudChlKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICBvbk1pbnV0ZUNoYW5nZShtaW51dGU6IE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2UpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fdGltZXBpY2tlclNydi5taW51dGUgPSBtaW51dGU7XG4gICAgICAgIHRoaXMuX29uVGltZUNoYW5nZSgpO1xuICAgIH1cblxuICAgIHNldFRpbWUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZGF0YS50aW1lcGlja2VyQmFzZVJlZi50aW1lU2V0Lm5leHQodGhpcy5fdGltZXBpY2tlclNydi5nZXRGdWxsVGltZSh0aGlzLmRhdGEuZm9ybWF0KSk7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2RlZmluZVRpbWUoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1pblRpbWUgPSB0aGlzLmRhdGEubWluVGltZTtcblxuICAgICAgICBpZiAobWluVGltZSAmJiAoIXRoaXMuZGF0YS50aW1lICYmICF0aGlzLmRhdGEuZGVmYXVsdFRpbWUpKSB7XG4gICAgICAgICAgICBjb25zdCB0aW1lID0gTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIuZnJvbURhdGVUaW1lVG9TdHJpbmcobWluVGltZSwgdGhpcy5kYXRhLmZvcm1hdCk7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldERlZmF1bHRUaW1lKHRpbWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9vblRpbWVDaGFuZ2UoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHRpbWUgPSBOZ3hNYXRUaW1lcGlja2VyQWRhcHRlci50b0xvY2FsZVRpbWVTdHJpbmcodGhpcy5fdGltZXBpY2tlclNydi5nZXRGdWxsVGltZSh0aGlzLmRhdGEuZm9ybWF0KSwge1xuICAgICAgICAgICAgbG9jYWxlOiB0aGlzLl9sb2NhbGUsXG4gICAgICAgICAgICBmb3JtYXQ6IHRoaXMuZGF0YS5mb3JtYXRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5kYXRhLnRpbWVwaWNrZXJCYXNlUmVmLnRpbWVDaGFuZ2VkLmVtaXQodGltZSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9zZXREZWZhdWx0VGltZSh0aW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fdGltZXBpY2tlclNydi5zZXREZWZhdWx0VGltZUlmQXZhaWxhYmxlKFxuICAgICAgICAgICAgdGltZSwgdGhpcy5kYXRhLm1pblRpbWUsIHRoaXMuZGF0YS5tYXhUaW1lLCB0aGlzLmRhdGEuZm9ybWF0LCB0aGlzLmRhdGEubWludXRlc0dhcCk7XG4gICAgfVxufVxuIl19