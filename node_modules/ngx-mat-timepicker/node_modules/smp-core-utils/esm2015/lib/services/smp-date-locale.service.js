import { Injectable } from "@angular/core";
import { NativeDateAdapter } from "@angular/material/core";
import { includes } from "lodash";
const smpSep = "/";
const smpDay = "d";
const smpDayDoubled = "dd";
const smpMonth = "M";
const smpMonthDoubled = "MM";
const smpYear = "yyyy";
const smpCurrentYear = new Date().getFullYear();
const smpCentury = Math.round(smpCurrentYear / 100);
export const SMP_LOCALE_IT_IT = "it-IT";
export const SMP_LOCALE_EN_GB = "en-GB";
export const SMP_LOCALE_EN_US = "en-US";
export const SMP_FORMATS = {
    "it-IT": `${smpDayDoubled}${smpSep}${smpMonthDoubled}${smpSep}${smpYear}`,
    "en-GB": `${smpDayDoubled}${smpSep}${smpMonthDoubled}${smpSep}${smpYear}`,
    "en-US": `${smpMonth}${smpSep}${smpDay}${smpSep}${smpYear}`,
};
export const SMP_DATE_FORMATS_IT = {
    parse: {
        dateInput: { month: "numeric", year: "numeric", day: "numeric" }
    },
    display: {
        dateInput: SMP_FORMATS[SMP_LOCALE_IT_IT],
        monthYearLabel: `${smpMonthDoubled}${smpSep}${smpYear}`,
        dateA11yLabel: SMP_FORMATS[SMP_LOCALE_IT_IT],
        monthYearA11yLabel: `${smpMonthDoubled}${smpSep}${smpYear}`
    }
};
export const SMP_DATE_FORMATS_EN_GB = {
    parse: {
        dateInput: { month: "numeric", year: "numeric", day: "numeric" }
    },
    display: {
        dateInput: SMP_FORMATS[SMP_LOCALE_EN_GB],
        monthYearLabel: `${smpMonthDoubled}${smpSep}${smpYear}`,
        dateA11yLabel: SMP_FORMATS[SMP_LOCALE_EN_GB],
        monthYearA11yLabel: `${smpMonthDoubled}${smpSep}${smpYear}`
    }
};
export const SMP_DATE_FORMATS_EN_US = {
    parse: {
        dateInput: { month: "numeric", year: "numeric", day: "numeric" }
    },
    display: {
        dateInput: SMP_FORMATS[SMP_LOCALE_EN_US],
        monthYearLabel: `${smpMonth}${smpSep}${smpYear}`,
        dateA11yLabel: SMP_FORMATS[SMP_LOCALE_EN_US],
        monthYearA11yLabel: `${smpMonth}${smpSep}${smpYear}`
    }
};
export class SmpMatDateLocale extends NativeDateAdapter {
    constructor() {
        super(...arguments);
        this.display = SMP_DATE_FORMATS_EN_GB.display;
    }
    get currentLocale() {
        return this.locale;
    }
    format(date, _displayFormat_) {
        const day = date.getDate();
        const month = date.getMonth() + 1;
        const year = date.getFullYear();
        switch (this.display.dateInput) {
            case SMP_DATE_FORMATS_IT.display.dateInput:
                return this._addLeadingZeroes(day) + smpSep + this._addLeadingZeroes(month) + smpSep + year;
            case SMP_DATE_FORMATS_EN_GB.display.dateInput:
                return this._addLeadingZeroes(day) + smpSep + this._addLeadingZeroes(month) + smpSep + year;
            case SMP_DATE_FORMATS_EN_US.display.dateInput:
                return month + smpSep + day + smpSep + year;
            default:
                let formattedDate = "";
                try {
                    formattedDate = date.toLocaleDateString(SMP_LOCALE_EN_GB);
                }
                catch (e) {
                    console.warn("Catched error while printing ", e);
                    formattedDate = date.toDateString();
                }
                return formattedDate;
        }
    }
    parse(value) {
        if (includes([SMP_DATE_FORMATS_IT.display.dateInput, SMP_DATE_FORMATS_EN_GB.display.dateInput], this.display.dateInput)) {
            if (typeof value === typeof "" && value.length > 0) {
                const str = value.split(smpSep);
                if (str.length < 3) {
                    return new Date("smp");
                }
                if (str[2].length < 4) {
                    str[2] = smpCentury + str[2];
                }
                if (str[2].length !== 4) {
                    return new Date("smp");
                }
                const year = +str[2];
                const month = +str[1] - 1;
                const day = +str[0];
                return new Date(year, month, day);
            }
            return null;
        }
        else if (this.display.dateInput === SMP_DATE_FORMATS_EN_US.display.dateInput) {
            if (typeof value === typeof "" && value.length > 0) {
                const str = value.split(smpSep);
                if (str.length < 3) {
                    return new Date("smp");
                }
                if (str[2].length < 4) {
                    str[2] = smpCentury + str[2];
                }
                if (str[2].length !== 4) {
                    return new Date("smp");
                }
                const year = +str[2];
                const month = +str[0] - 1;
                const day = +str[1];
                return new Date(year, month, day);
            }
            return null;
        }
        else {
            console.warn("Date input format not valid." +
                " Be sure to use SMP_DATE_FORMATS" +
                " or extend this class with your own 'parser' and format 'methods'");
            console.info("For a complete guide visit github.com/tonysamperi/ngx-mat-lib");
            return null;
        }
    }
    setLocale(locale) {
        switch (locale) {
            case SMP_LOCALE_IT_IT:
                this.display = SMP_DATE_FORMATS_IT.display;
                break;
            case SMP_LOCALE_EN_GB:
                this.display = SMP_DATE_FORMATS_EN_GB.display;
                break;
            case SMP_LOCALE_EN_US:
                this.display = SMP_DATE_FORMATS_EN_US.display;
                break;
            default:
                this.display = SMP_DATE_FORMATS_EN_GB.display;
                break;
        }
        super.setLocale(locale);
    }
    _addLeadingZeroes(n) {
        return ("0" + n).slice(-2);
    }
}
SmpMatDateLocale.decorators = [
    { type: Injectable }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21wLWRhdGUtbG9jYWxlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zbXAtY29yZS11dGlscy9zcmMvbGliL3NlcnZpY2VzL3NtcC1kYXRlLWxvY2FsZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDekMsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFLekQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLFFBQVEsQ0FBQztBQUVoQyxNQUFNLE1BQU0sR0FBVyxHQUFHLENBQUM7QUFDM0IsTUFBTSxNQUFNLEdBQVcsR0FBRyxDQUFDO0FBQzNCLE1BQU0sYUFBYSxHQUFXLElBQUksQ0FBQztBQUNuQyxNQUFNLFFBQVEsR0FBVyxHQUFHLENBQUM7QUFDN0IsTUFBTSxlQUFlLEdBQVcsSUFBSSxDQUFDO0FBQ3JDLE1BQU0sT0FBTyxHQUFXLE1BQU0sQ0FBQztBQUMvQixNQUFNLGNBQWMsR0FBVyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQ3hELE1BQU0sVUFBVSxHQUFXLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBRTVELE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFXLE9BQU8sQ0FBQztBQUNoRCxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBVyxPQUFPLENBQUM7QUFDaEQsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQVcsT0FBTyxDQUFDO0FBRWhELE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRztJQUN2QixPQUFPLEVBQUUsR0FBRyxhQUFhLEdBQUcsTUFBTSxHQUFHLGVBQWUsR0FBRyxNQUFNLEdBQUcsT0FBTyxFQUFFO0lBQ3pFLE9BQU8sRUFBRSxHQUFHLGFBQWEsR0FBRyxNQUFNLEdBQUcsZUFBZSxHQUFH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b3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGV9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge05hdGl2ZURhdGVBZGFwdGVyfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvY29yZVwiO1xuaW1wb3J0IHtNYXREYXRlRm9ybWF0c30gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL2NvcmUvZGF0ZXRpbWUvZGF0ZS1mb3JtYXRzXCI7XG4vL1xuaW1wb3J0IHtTbXBEYXRlRGlzcGxheX0gZnJvbSBcIi4uL21vZGVscy9zbXAtZGF0ZS1kaXNwbGF5Lm1vZGVsXCI7XG4vL1xuaW1wb3J0IHtpbmNsdWRlc30gZnJvbSBcImxvZGFzaFwiO1xuXG5jb25zdCBzbXBTZXA6IHN0cmluZyA9IFwiL1wiO1xuY29uc3Qgc21wRGF5OiBzdHJpbmcgPSBcImRcIjtcbmNvbnN0IHNtcERheURvdWJsZWQ6IHN0cmluZyA9IFwiZGRcIjtcbmNvbnN0IHNtcE1vbnRoOiBzdHJpbmcgPSBcIk1cIjtcbmNvbnN0IHNtcE1vbnRoRG91YmxlZDogc3RyaW5nID0gXCJNTVwiO1xuY29uc3Qgc21wWWVhcjogc3RyaW5nID0gXCJ5eXl5XCI7XG5jb25zdCBzbXBDdXJyZW50WWVhcjogbnVtYmVyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpO1xuY29uc3Qgc21wQ2VudHVyeTogbnVtYmVyID0gTWF0aC5yb3VuZChzbXBDdXJyZW50WWVhciAvIDEwMCk7XG5cbmV4cG9ydCBjb25zdCBTTVBfTE9DQUxFX0lUX0lUOiBzdHJpbmcgPSBcIml0LUlUXCI7XG5leHBvcnQgY29uc3QgU01QX0xPQ0FMRV9FTl9HQjogc3RyaW5nID0gXCJlbi1HQlwiO1xuZXhwb3J0IGNvbnN0IFNNUF9MT0NBTEVfRU5fVVM6IHN0cmluZyA9IFwiZW4tVVNcIjtcblxuZXhwb3J0IGNvbnN0IFNNUF9GT1JNQVRTID0ge1xuICAgIFwiaXQtSVRcIjogYCR7c21wRGF5RG91YmxlZH0ke3NtcFNlcH0ke3NtcE1vbnRoRG91YmxlZH0ke3NtcFNlcH0ke3NtcFllYXJ9YCxcbiAgICBcImVuLUdCXCI6IGAke3NtcERheURvdWJsZWR9JHtzbXBTZXB9JHtzbXBNb250aERvdWJsZWR9JHtzbXBTZXB9JHtzbXBZZWFyfWAsXG4gICAgXCJlbi1VU1wiOiBgJHtzbXBNb250aH0ke3NtcFNlcH0ke3NtcERheX0ke3NtcFNlcH0ke3NtcFllYXJ9YCxcbn07XG5cbmV4cG9ydCBjb25zdCBTTVBfREFURV9GT1JNQVRTX0lUOiBNYXREYXRlRm9ybWF0cyA9IHtcbiAgICBwYXJzZToge1xuICAgICAgICBkYXRlSW5wdXQ6IHttb250aDogXCJudW1lcmljXCIsIHllYXI6IFwibnVtZXJpY1wiLCBkYXk6IFwibnVtZXJpY1wifVxuICAgIH0sXG4gICAgZGlzcGxheToge1xuICAgICAgICBkYXRlSW5wdXQ6IFNNUF9GT1JNQVRTW1NNUF9MT0NBTEVfSVRfSVRdLFxuICAgICAgICBtb250aFllYXJMYWJlbDogYCR7c21wTW9udGhEb3VibGVkfSR7c21wU2VwfSR7c21wWWVhcn1gLFxuICAgICAgICBkYXRlQTExeUxhYmVsOiBTTVBfRk9STUFUU1tTTVBfTE9DQUxFX0lUX0lUXSxcbiAgICAgICAgbW9udGhZZWFyQTExeUxhYmVsOiBgJHtzbXBNb250aERvdWJsZWR9JHtzbXBTZXB9JHtzbXBZZWFyfWBcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgU01QX0RBVEVfRk9STUFUU19FTl9HQjogTWF0RGF0ZUZvcm1hdHMgPSB7XG4gICAgcGFyc2U6IHtcbiAgICAgICAgZGF0ZUlucHV0OiB7bW9udGg6IFwibnVtZXJpY1wiLCB5ZWFyOiBcIm51bWVyaWNcIiwgZGF5OiBcIm51bWVyaWNcIn1cbiAgICB9LFxuICAgIGRpc3BsYXk6IHtcbiAgICAgICAgZGF0ZUlucHV0OiBTTVBfRk9STUFUU1tTTVBfTE9DQUxFX0VOX0dCXSxcbiAgICAgICAgbW9udGhZZWFyTGFiZWw6IGAke3NtcE1vbnRoRG91YmxlZH0ke3NtcFNlcH0ke3NtcFllYXJ9YCxcbiAgICAgICAgZGF0ZUExMXlMYWJlbDogU01QX0ZPUk1BVFNbU01QX0xPQ0FMRV9FTl9HQl0sXG4gICAgICAgIG1vbnRoWWVhckExMXlMYWJlbDogYCR7c21wTW9udGhEb3VibGVkfSR7c21wU2VwfSR7c21wWWVhcn1gXG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IFNNUF9EQVRFX0ZPUk1BVFNfRU5fVVM6IE1hdERhdGVGb3JtYXRzID0ge1xuICAgIHBhcnNlOiB7XG4gICAgICAgIGRhdGVJbnB1dDoge21vbnRoOiBcIm51bWVyaWNcIiwgeWVhcjogXCJudW1lcmljXCIsIGRheTogXCJudW1lcmljXCJ9XG4gICAgfSxcbiAgICBkaXNwbGF5OiB7XG4gICAgICAgIGRhdGVJbnB1dDogU01QX0ZPUk1BVFNbU01QX0xPQ0FMRV9FTl9VU10sXG4gICAgICAgIG1vbnRoWWVhckxhYmVsOiBgJHtzbXBNb250aH0ke3NtcFNlcH0ke3NtcFllYXJ9YCxcbiAgICAgICAgZGF0ZUExMXlMYWJlbDogU01QX0ZPUk1BVFNbU01QX0xPQ0FMRV9FTl9VU10sXG4gICAgICAgIG1vbnRoWWVhckExMXlMYWJlbDogYCR7c21wTW9udGh9JHtzbXBTZXB9JHtzbXBZZWFyfWBcbiAgICB9XG59O1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU21wTWF0RGF0ZUxvY2FsZSBleHRlbmRzIE5hdGl2ZURhdGVBZGFwdGVyIHtcblxuICAgIGdldCBjdXJyZW50TG9jYWxlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZTtcbiAgICB9XG5cbiAgICBkaXNwbGF5OiBTbXBEYXRlRGlzcGxheSA9IFNNUF9EQVRFX0ZPUk1BVFNfRU5fR0IuZGlzcGxheTtcblxuICAgIGZvcm1hdChkYXRlOiBEYXRlLCBfZGlzcGxheUZvcm1hdF86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF0ZSgpO1xuICAgICAgICBjb25zdCBtb250aCA9IGRhdGUuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIHN3aXRjaCAodGhpcy5kaXNwbGF5LmRhdGVJbnB1dCkge1xuICAgICAgICAgICAgY2FzZSBTTVBfREFURV9GT1JNQVRTX0lULmRpc3BsYXkuZGF0ZUlucHV0OlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRMZWFkaW5nWmVyb2VzKGRheSkgKyBzbXBTZXAgKyB0aGlzLl9hZGRMZWFkaW5nWmVyb2VzKG1vbnRoKSArIHNtcFNlcCArIHllYXI7XG4gICAgICAgICAgICBjYXNlIFNNUF9EQVRFX0ZPUk1BVFNfRU5fR0IuZGlzcGxheS5kYXRlSW5wdXQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FkZExlYWRpbmdaZXJvZXMoZGF5KSArIHNtcFNlcCArIHRoaXMuX2FkZExlYWRpbmdaZXJvZXMobW9udGgpICsgc21wU2VwICsgeWVhcjtcbiAgICAgICAgICAgIGNhc2UgU01QX0RBVEVfRk9STUFUU19FTl9VUy5kaXNwbGF5LmRhdGVJbnB1dDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9udGggKyBzbXBTZXAgKyBkYXkgKyBzbXBTZXAgKyB5ZWFyO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBsZXQgZm9ybWF0dGVkRGF0ZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkRGF0ZSA9IGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKFNNUF9MT0NBTEVfRU5fR0IpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiQ2F0Y2hlZCBlcnJvciB3aGlsZSBwcmludGluZyBcIiwgZSk7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZERhdGUgPSBkYXRlLnRvRGF0ZVN0cmluZygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWREYXRlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcGFyc2UodmFsdWU6IGFueSk6IERhdGUgfCBudWxsIHtcbiAgICAgICAgLy8gZGQvTU0veXl5eVxuICAgICAgICBpZiAoaW5jbHVkZXMoW1NNUF9EQVRFX0ZPUk1BVFNfSVQuZGlzcGxheS5kYXRlSW5wdXQsIFNNUF9EQVRFX0ZPUk1BVFNfRU5fR0IuZGlzcGxheS5kYXRlSW5wdXRdLCB0aGlzLmRpc3BsYXkuZGF0ZUlucHV0KSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gdHlwZW9mIFwiXCIgJiYgdmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0ciA9IHZhbHVlLnNwbGl0KHNtcFNlcCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0ci5sZW5ndGggPCAzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShcInNtcFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHN0clsyXS5sZW5ndGggPCA0KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0clsyXSA9IHNtcENlbnR1cnkgKyBzdHJbMl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzdHJbMl0ubGVuZ3RoICE9PSA0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShcInNtcFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgeWVhciA9ICtzdHJbMl07XG4gICAgICAgICAgICAgICAgY29uc3QgbW9udGggPSArc3RyWzFdIC0gMTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXkgPSArc3RyWzBdO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICAvLyBNL2QveXl5eVxuICAgICAgICBlbHNlIGlmICh0aGlzLmRpc3BsYXkuZGF0ZUlucHV0ID09PSBTTVBfREFURV9GT1JNQVRTX0VOX1VTLmRpc3BsYXkuZGF0ZUlucHV0KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSB0eXBlb2YgXCJcIiAmJiB2YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RyID0gdmFsdWUuc3BsaXQoc21wU2VwKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RyLmxlbmd0aCA8IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKFwic21wXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc3RyWzJdLmxlbmd0aCA8IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyWzJdID0gc21wQ2VudHVyeSArIHN0clsyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHN0clsyXS5sZW5ndGggIT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKFwic21wXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB5ZWFyID0gK3N0clsyXTtcbiAgICAgICAgICAgICAgICBjb25zdCBtb250aCA9ICtzdHJbMF0gLSAxO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRheSA9ICtzdHJbMV07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRGF0ZSBpbnB1dCBmb3JtYXQgbm90IHZhbGlkLlwiICtcbiAgICAgICAgICAgICAgICBcIiBCZSBzdXJlIHRvIHVzZSBTTVBfREFURV9GT1JNQVRTXCIgK1xuICAgICAgICAgICAgICAgIFwiIG9yIGV4dGVuZCB0aGlzIGNsYXNzIHdpdGggeW91ciBvd24gJ3BhcnNlcicgYW5kIGZvcm1hdCAnbWV0aG9kcydcIik7XG4gICAgICAgICAgICBjb25zb2xlLmluZm8oXCJGb3IgYSBjb21wbGV0ZSBndWlkZSB2aXNpdCBnaXRodWIuY29tL3RvbnlzYW1wZXJpL25neC1tYXQtbGliXCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldExvY2FsZShsb2NhbGU6IGFueSkge1xuICAgICAgICBzd2l0Y2ggKGxvY2FsZSkge1xuICAgICAgICAgICAgY2FzZSBTTVBfTE9DQUxFX0lUX0lUOlxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSA9IFNNUF9EQVRFX0ZPUk1BVFNfSVQuZGlzcGxheTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgU01QX0xPQ0FMRV9FTl9HQjpcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkgPSBTTVBfREFURV9GT1JNQVRTX0VOX0dCLmRpc3BsYXk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFNNUF9MT0NBTEVfRU5fVVM6XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5ID0gU01QX0RBVEVfRk9STUFUU19FTl9VUy5kaXNwbGF5O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkgPSBTTVBfREFURV9GT1JNQVRTX0VOX0dCLmRpc3BsYXk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIuc2V0TG9jYWxlKGxvY2FsZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfYWRkTGVhZGluZ1plcm9lcyhuOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIChcIjBcIiArIG4pLnNsaWNlKC0yKTtcbiAgICB9XG59XG4iXX0=