/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/ngx-mat-timepicker.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from "@angular/core";
import { BehaviorSubject } from "rxjs";
import { NgxMatTimepickerPeriods } from "../models/ngx-mat-timepicker-periods.enum";
import { NgxMatTimepickerAdapter } from "./ngx-mat-timepicker-adapter";
import { DateTime } from "ts-luxon";
import * as i0 from "@angular/core";
/** @type {?} */
const DEFAULT_HOUR = {
    time: 12,
    angle: 360
};
/** @type {?} */
const DEFAULT_MINUTE = {
    time: 0,
    angle: 360
};
export class NgxMatTimepickerService {
    constructor() {
        this._hour$ = new BehaviorSubject(DEFAULT_HOUR);
        this._minute$ = new BehaviorSubject(DEFAULT_MINUTE);
        this._period$ = new BehaviorSubject(NgxMatTimepickerPeriods.AM);
    }
    /**
     * @param {?} hour
     * @return {?}
     */
    set hour(hour) {
        this._hour$.next(hour);
    }
    /**
     * @param {?} minute
     * @return {?}
     */
    set minute(minute) {
        this._minute$.next(minute);
    }
    /**
     * @param {?} period
     * @return {?}
     */
    set period(period) {
        /** @type {?} */
        const isPeriodValid = (period === NgxMatTimepickerPeriods.AM) || (period === NgxMatTimepickerPeriods.PM);
        if (isPeriodValid) {
            this._period$.next(period);
        }
    }
    /**
     * @return {?}
     */
    get selectedHour() {
        return this._hour$.asObservable();
    }
    /**
     * @return {?}
     */
    get selectedMinute() {
        return this._minute$.asObservable();
    }
    /**
     * @return {?}
     */
    get selectedPeriod() {
        return this._period$.asObservable();
    }
    /**
     * @param {?} format
     * @return {?}
     */
    getFullTime(format) {
        /** @type {?} */
        const selectedHour = this._hour$.getValue().time;
        /** @type {?} */
        const selectedMinute = this._minute$.getValue().time;
        /** @type {?} */
        const hour = selectedHour != null ? selectedHour : DEFAULT_HOUR.time;
        /** @type {?} */
        const minute = selectedMinute != null ? selectedMinute : DEFAULT_MINUTE.time;
        /** @type {?} */
        const period = format === 12 ? this._period$.getValue() : "";
        /** @type {?} */
        const time = `${hour}:${minute} ${period}`.trim();
        return NgxMatTimepickerAdapter.formatTime(time, { format });
    }
    /**
     * @param {?} time
     * @param {?} min
     * @param {?} max
     * @param {?} format
     * @param {?=} minutesGap
     * @return {?}
     */
    setDefaultTimeIfAvailable(time, min, max, format, minutesGap) {
        /* Workaround to double error message*/
        try {
            if (NgxMatTimepickerAdapter.isTimeAvailable(time, min, max, "minutes", minutesGap)) {
                this._setDefaultTime(time, format);
            }
        }
        catch (e) {
            console.error(e);
        }
    }
    /**
     * @private
     * @return {?}
     */
    _resetTime() {
        this.hour = Object.assign({}, DEFAULT_HOUR);
        this.minute = Object.assign({}, DEFAULT_MINUTE);
        this.period = NgxMatTimepickerPeriods.AM;
    }
    /**
     * @private
     * @param {?} time
     * @param {?} format
     * @return {?}
     */
    _setDefaultTime(time, format) {
        /** @type {?} */
        const defaultTime = NgxMatTimepickerAdapter.parseTime(time, { format }).toJSDate();
        // Check on null, because invalid date will be null
        if (DateTime.fromJSDate(defaultTime) !== null) {
            /** @type {?} */
            const period = time.substr(time.length - 2).toUpperCase();
            /** @type {?} */
            const hour = defaultTime.getHours();
            this.hour = Object.assign(Object.assign({}, DEFAULT_HOUR), { time: formatHourByPeriod(hour, (/** @type {?} */ (period))) });
            this.minute = Object.assign(Object.assign({}, DEFAULT_MINUTE), { time: defaultTime.getMinutes() });
            this.period = (/** @type {?} */ (period));
        }
        else {
            this._resetTime();
        }
    }
}
NgxMatTimepickerService.decorators = [
    { type: Injectable, args: [{
                providedIn: "root"
            },] }
];
/** @nocollapse */ NgxMatTimepickerService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgxMatTimepickerService_Factory() { return new NgxMatTimepickerService(); }, token: NgxMatTimepickerService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgxMatTimepickerService.prototype._hour$;
    /**
     * @type {?}
     * @private
     */
    NgxMatTimepickerService.prototype._minute$;
    /**
     * @type {?}
     * @private
     */
    NgxMatTimepickerService.prototype._period$;
}
/**
 *
 *  Format hour in 24hours format to meridian (AM or PM) format
 * @param {?} hour
 * @param {?} period
 * @return {?}
 */
function formatHourByPeriod(hour, period) {
    switch (period) {
        case NgxMatTimepickerPeriods.AM:
            return hour === 0 ? 12 : hour;
        case NgxMatTimepickerPeriods.PM:
            return hour === 12 ? 12 : hour - 12;
        default:
            return hour;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC10aW1lcGlja2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtbWF0LXRpbWVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvbmd4LW1hdC10aW1lcGlja2VyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRXpDLE9BQU8sRUFBQyxlQUFlLEVBQWEsTUFBTSxNQUFNLENBQUM7QUFDakQsT0FBTyxFQUFDLHVCQUF1QixFQUFDLE1BQU0sMkNBQTJDLENBQUM7QUFDbEYsT0FBTyxFQUFDLHVCQUF1QixFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDckUsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLFVBQVUsQ0FBQzs7O01BRTVCLFlBQVksR0FBOEI7SUFDNUMsSUFBSSxFQUFFLEVBQUU7SUFDUixLQUFLLEVBQUUsR0FBRztDQUNiOztNQUNLLGNBQWMsR0FBOEI7SUFDOUMsSUFBSSxFQUFFLENBQUM7SUFDUCxLQUFLLEVBQUUsR0FBRztDQUNiO0FBS0QsTUFBTSxPQUFPLHVCQUF1QjtJQUhwQztRQWtDWSxXQUFNLEdBQUcsSUFBSSxlQUFlLENBQTRCLFlBQVksQ0FBQyxDQUFDO1FBQ3RFLGFBQVEsR0FBRyxJQUFJLGVBQWUsQ0FBNEIsY0FBYyxDQUFDLENBQUM7UUFDMUUsYUFBUSxHQUFHLElBQUksZUFBZSxDQUEwQix1QkFBdUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztLQWdEL0Y7Ozs7O0lBOUVHLElBQUksSUFBSSxDQUFDLElBQStCO1FBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBRUQsSUFBSSxNQUFNLENBQUMsTUFBaUM7UUFDeEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7Ozs7SUFFRCxJ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QUFFLGtCQUFrQixDQUFDLElBQUksRUFBRSxtQkFBQSxNQUFNLEVBQTJCLENBQUMsR0FBQyxDQUFDO1lBQ2pHLElBQUksQ0FBQyxNQUFNLG1DQUFPLGNBQWMsS0FBRSxJQUFJLEVBQUUsV0FBVyxDQUFDLFVBQVUsRUFBRSxHQUFDLENBQUM7WUFDbEUsSUFBSSxDQUFDLE1BQU0sR0FBRyxtQkFBQSxNQUFNLEVBQTJCLENBQUM7U0FFbkQ7YUFDSTtZQUNELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNyQjtJQUNMLENBQUM7OztZQW5GSixVQUFVLFNBQUM7Z0JBQ1IsVUFBVSxFQUFFLE1BQU07YUFDckI7Ozs7Ozs7O0lBZ0NHLHlDQUE4RTs7Ozs7SUFDOUUsMkNBQWtGOzs7OztJQUNsRiwyQ0FBNEY7Ozs7Ozs7OztBQXFEaEcsU0FBUyxrQkFBa0IsQ0FBQyxJQUFZLEVBQUUsTUFBK0I7SUFDckUsUUFBUSxNQUFNLEVBQUU7UUFDWixLQUFLLHVCQUF1QixDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNsQyxLQUFLLHVCQUF1QixDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDeEM7WUFDSSxPQUFPLElBQUksQ0FBQztLQUNuQjtBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGV9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge05neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2V9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLWNsb2NrLWZhY2UuaW50ZXJmYWNlXCI7XG5pbXBvcnQge0JlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZX0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7Tmd4TWF0VGltZXBpY2tlclBlcmlvZHN9IGZyb20gXCIuLi9tb2RlbHMvbmd4LW1hdC10aW1lcGlja2VyLXBlcmlvZHMuZW51bVwiO1xuaW1wb3J0IHtOZ3hNYXRUaW1lcGlja2VyQWRhcHRlcn0gZnJvbSBcIi4vbmd4LW1hdC10aW1lcGlja2VyLWFkYXB0ZXJcIjtcbmltcG9ydCB7RGF0ZVRpbWV9IGZyb20gXCJ0cy1sdXhvblwiO1xuXG5jb25zdCBERUZBVUxUX0hPVVI6IE5neE1hdFRpbWVwaWNrZXJDbG9ja0ZhY2UgPSB7XG4gICAgdGltZTogMTIsXG4gICAgYW5nbGU6IDM2MFxufTtcbmNvbnN0IERFRkFVTFRfTUlOVVRFOiBOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlID0ge1xuICAgIHRpbWU6IDAsXG4gICAgYW5nbGU6IDM2MFxufTtcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46IFwicm9vdFwiXG59KVxuZXhwb3J0IGNsYXNzIE5neE1hdFRpbWVwaWNrZXJTZXJ2aWNlIHtcblxuXG4gICAgc2V0IGhvdXIoaG91cjogTmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZSkge1xuICAgICAgICB0aGlzLl9ob3VyJC5uZXh0KGhvdXIpO1xuICAgIH1cblxuICAgIHNldCBtaW51dGUobWludXRlOiBOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlKSB7XG4gICAgICAgIHRoaXMuX21pbnV0ZSQubmV4dChtaW51dGUpO1xuICAgIH1cblxuICAgIHNldCBwZXJpb2QocGVyaW9kOiBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcykge1xuICAgICAgICBjb25zdCBpc1BlcmlvZFZhbGlkID0gKHBlcmlvZCA9PT0gTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU0pIHx8IChwZXJpb2QgPT09IE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzLlBNKTtcblxuICAgICAgICBpZiAoaXNQZXJpb2RWYWxpZCkge1xuICAgICAgICAgICAgdGhpcy5fcGVyaW9kJC5uZXh0KHBlcmlvZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgc2VsZWN0ZWRIb3VyKCk6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5faG91ciQuYXNPYnNlcnZhYmxlKCk7XG4gICAgfVxuXG4gICAgZ2V0IHNlbGVjdGVkTWludXRlKCk6IE9ic2VydmFibGU8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWludXRlJC5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBnZXQgc2VsZWN0ZWRQZXJpb2QoKTogT2JzZXJ2YWJsZTxOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcz4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGVyaW9kJC5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9ob3VyJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tmd4TWF0VGltZXBpY2tlckNsb2NrRmFjZT4oREVGQVVMVF9IT1VSKTtcbiAgICBwcml2YXRlIF9taW51dGUkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxOZ3hNYXRUaW1lcGlja2VyQ2xvY2tGYWNlPihERUZBVUxUX01JTlVURSk7XG4gICAgcHJpdmF0ZSBfcGVyaW9kJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tmd4TWF0VGltZXBpY2tlclBlcmlvZHM+KE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzLkFNKTtcblxuICAgIGdldEZ1bGxUaW1lKGZvcm1hdDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRIb3VyID0gdGhpcy5faG91ciQuZ2V0VmFsdWUoKS50aW1lO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1pbnV0ZSA9IHRoaXMuX21pbnV0ZSQuZ2V0VmFsdWUoKS50aW1lO1xuICAgICAgICBjb25zdCBob3VyID0gc2VsZWN0ZWRIb3VyICE9IG51bGwgPyBzZWxlY3RlZEhvdXIgOiBERUZBVUxUX0hPVVIudGltZTtcbiAgICAgICAgY29uc3QgbWludXRlID0gc2VsZWN0ZWRNaW51dGUgIT0gbnVsbCA/IHNlbGVjdGVkTWludXRlIDogREVGQVVMVF9NSU5VVEUudGltZTtcbiAgICAgICAgY29uc3QgcGVyaW9kID0gZm9ybWF0ID09PSAxMiA/IHRoaXMuX3BlcmlvZCQuZ2V0VmFsdWUoKSA6IFwiXCI7XG4gICAgICAgIGNvbnN0IHRpbWUgPSBgJHtob3VyfToke21pbnV0ZX0gJHtwZXJpb2R9YC50cmltKCk7XG5cbiAgICAgICAgcmV0dXJuIE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmZvcm1hdFRpbWUodGltZSwge2Zvcm1hdH0pO1xuICAgIH1cblxuXG4gICAgc2V0RGVmYXVsdFRpbWVJZkF2YWlsYWJsZSh0aW1lOiBzdHJpbmcsIG1pbjogRGF0ZVRpbWUsIG1heDogRGF0ZVRpbWUsIGZvcm1hdDogbnVtYmVyLCBtaW51dGVzR2FwPzogbnVtYmVyKSB7XG4gICAgICAgIC8qIFdvcmthcm91bmQgdG8gZG91YmxlIGVycm9yIG1lc3NhZ2UqL1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKE5neE1hdFRpbWVwaWNrZXJBZGFwdGVyLmlzVGltZUF2YWlsYWJsZSh0aW1lLCBtaW4sIG1heCwgXCJtaW51dGVzXCIsIG1pbnV0ZXNHYXApKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFRpbWUodGltZSwgZm9ybWF0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3Jlc2V0VGltZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ob3VyID0gey4uLkRFRkFVTFRfSE9VUn07XG4gICAgICAgIHRoaXMubWludXRlID0gey4uLkRFRkFVTFRfTUlOVVRFfTtcbiAgICAgICAgdGhpcy5wZXJpb2QgPSBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5BTTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9zZXREZWZhdWx0VGltZSh0aW1lOiBzdHJpbmcsIGZvcm1hdDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRUaW1lID0gTmd4TWF0VGltZXBpY2tlckFkYXB0ZXIucGFyc2VUaW1lKHRpbWUsIHtmb3JtYXR9KS50b0pTRGF0ZSgpO1xuXG4gICAgICAgIC8vIENoZWNrIG9uIG51bGwsIGJlY2F1c2UgaW52YWxpZCBkYXRlIHdpbGwgYmUgbnVsbFxuICAgICAgICBpZiAoRGF0ZVRpbWUuZnJvbUpTRGF0ZShkZWZhdWx0VGltZSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHBlcmlvZCA9IHRpbWUuc3Vic3RyKHRpbWUubGVuZ3RoIC0gMikudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGhvdXIgPSBkZWZhdWx0VGltZS5nZXRIb3VycygpO1xuXG4gICAgICAgICAgICB0aGlzLmhvdXIgPSB7Li4uREVGQVVMVF9IT1VSLCB0aW1lOiBmb3JtYXRIb3VyQnlQZXJpb2QoaG91ciwgcGVyaW9kIGFzIE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzKX07XG4gICAgICAgICAgICB0aGlzLm1pbnV0ZSA9IHsuLi5ERUZBVUxUX01JTlVURSwgdGltZTogZGVmYXVsdFRpbWUuZ2V0TWludXRlcygpfTtcbiAgICAgICAgICAgIHRoaXMucGVyaW9kID0gcGVyaW9kIGFzIE5neE1hdFRpbWVwaWNrZXJQZXJpb2RzO1xuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9yZXNldFRpbWUoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqKlxuICogIEZvcm1hdCBob3VyIGluIDI0aG91cnMgZm9ybWF0IHRvIG1lcmlkaWFuIChBTSBvciBQTSkgZm9ybWF0XG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEhvdXJCeVBlcmlvZChob3VyOiBudW1iZXIsIHBlcmlvZDogTmd4TWF0VGltZXBpY2tlclBlcmlvZHMpOiBudW1iZXIge1xuICAgIHN3aXRjaCAocGVyaW9kKSB7XG4gICAgICAgIGNhc2UgTmd4TWF0VGltZXBpY2tlclBlcmlvZHMuQU06XG4gICAgICAgICAgICByZXR1cm4gaG91ciA9PT0gMCA/IDEyIDogaG91cjtcbiAgICAgICAgY2FzZSBOZ3hNYXRUaW1lcGlja2VyUGVyaW9kcy5QTTpcbiAgICAgICAgICAgIHJldHVybiBob3VyID09PSAxMiA/IDEyIDogaG91ciAtIDEyO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGhvdXI7XG4gICAgfVxufVxuIl19