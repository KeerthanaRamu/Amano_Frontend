(self.webpackChunksmart=self.webpackChunksmart||[]).push([[5773],{85773:function(e,t,i){"use strict";i.r(t),i.d(t,{StudentScheduleModule:function(){return De}});var s=i(61116),a=i(31041),r=i(39199),n=i(5609),l=i(13070),o=i(9550),c=i(63589),u=i(84369),d=i(77307),h=i(13841),m=i(92935),p=i(59241),g=i(37112),f=i(69024),v=i(40994),A=i(1325),b=i(57173),y=i(97070),Z=i(87672),S=i(44716),_=i(51601),N=i(35729),T=i(81258),D=i(91681),w=i(99235),x=i(35366),q=i(97425),L=i(42693),U=i(89647),I=i(51816),k=i(529);let C=(()=>{class e{constructor(e){this.http=e,this.API_URL="assets/data/calendar.json",this.httpOptions={headers:new L.WM({"Content-Type":"application/json"})},this.dataChange=new q.X([])}get data(){return this.dataChange.value}getDialogData(){return this.dialogData}getAllCalendars(){return this.http.get(this.API_URL).pipe((0,I.K)(this.errorHandler))}deleteCalendar(e){this.dialogData=e}errorHandler(e){let t="";return t=e.error instanceof ErrorEvent?e.error.message:`Error Code: ${e.status}\nMessage: ${e.message}`,console.log(t),(0,U._)(t)}getScheduleList(){return this.http.get(`${k.N.apiUrl}/webRoutes/getScheduleList`).pipe((0,D.U)(e=>e))}setScheduleDetails(e,t,i){return this.http.post(`${k.N.apiUrl}/webRoutes/setScheduleDetails`,{calendarData:e,timeSlot:t,viewAssign_selected:i}).pipe((0,D.U)(e=>e))}getScheduleDetailsForStudent(e){return this.http.post(`${k.N.apiUrl}/webRoutes/getScheduleDetailsForStudent`,{statusid:e}).pipe((0,D.U)(e=>e))}updateScheduleDetails(e,t){return this.http.post(`${k.N.apiUrl}/webRoutes/updateScheduleDetails`,{calendarData:e,viewAssign_selected:t}).pipe((0,D.U)(e=>e))}deleteScheduleDetails(e){return this.http.post(`${k.N.apiUrl}/webRoutes/deleteScheduleDetails`,{calendarData:e}).pipe((0,D.U)(e=>e))}getTimeDetails(){return this.http.get(`${k.N.apiUrl}/webRoutes/getTimeDetails`).pipe((0,D.U)(e=>e))}getSelectedScheduleInfoStudent(e,t){return this.http.post(`${k.N.apiUrl}/webRoutes/getSelectedScheduleInfoStudent`,{calendarInfo:e,enrollData:t}).pipe((0,D.U)(e=>e))}getNRICNumberForStudentSchedule(){return this.http.get(`${k.N.apiUrl}/webRoutes/getNRICNumberForStudentSchedule`).pipe((0,D.U)(e=>e))}getPassportNumberForStudentSchedule(){return this.http.get(`${k.N.apiUrl}/webRoutes/getPassportNumberForStudentSchedule`).pipe((0,D.U)(e=>e))}getEnrollmentNumberForSchedule(e){return this.http.post(`${k.N.apiUrl}/webRoutes/getEnrollmentNumberForSchedule`,{studentId:e}).pipe((0,D.U)(e=>e))}checkPaymentDone(e){return this.http.post(`${k.N.apiUrl}/webRoutes/checkPaymentDone`,{studentInfo:e}).pipe((0,D.U)(e=>e))}getStudentSchedulePerEnroll(e){return this.http.post(`${k.N.apiUrl}/webRoutes/getStudentSchedulePerEnroll`,{studentInfo:e}).pipe((0,D.U)(e=>e))}setStudentScheduleInfo(e,t,i){return this.http.post(`${k.N.apiUrl}/webRoutes/setStudentScheduleInfo`,{finalArray:e,enrollData:t,rangelist:i}).pipe((0,D.U)(e=>e))}setPaymentDetails(e,t){return this.http.post(`${k.N.apiUrl}/webRoutes/setPaymentDetails`,{enrollValue:e,amountToBePaid:t}).pipe((0,D.U)(e=>e))}checkSessionPerWeek(e,t,i){return this.http.post(`${k.N.apiUrl}/webRoutes/checkSessionPerWeek`,{enrollData:e,firstday:t,lastday:i}).pipe((0,D.U)(e=>e))}}return e.\u0275fac=function(t){return new(t||e)(x.LFG(L.eN))},e.\u0275prov=x.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var E=i(50518),P=i(7436),F=i(60649);function O(e,t){if(1&e&&(x.TgZ(0,"div",9),x.TgZ(1,"p"),x._uU(2),x.qZA(),x.qZA()),2&e){const e=x.oxw();x.xp6(2),x.hij("",e.calendar.schedule_name," is Scheduled")}}function J(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"li",16),x.TgZ(1,"mat-radio-button",17),x.NdJ("change",function(t){const i=x.CHM(e).$implicit;return x.oxw(2).changeTimeDt(t,i)}),x._uU(2),x.qZA(),x.qZA()}if(2&e){const e=t.$implicit;x.xp6(1),x.Q6J("checked",e.checked)("disabled",e.disabled),x.xp6(1),x.hij(" ",e.range," ")}}function Y(e,t){if(1&e&&(x.TgZ(0,"div",9),x.TgZ(1,"label"),x._uU(2,"Schedule Time"),x.qZA(),x.TgZ(3,"div",14),x.YNc(4,J,3,3,"li",15),x.qZA(),x.qZA()),2&e){const e=x.oxw();x.xp6(4),x.Q6J("ngForOf",e.timeArray)}}function Q(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"mat-radio-button",22),x.NdJ("change",function(t){x.CHM(e);const i=x.oxw(2).$implicit;return x.oxw(2).instructorChange(t,i)}),x._uU(1),x.qZA()}if(2&e){const e=t.$implicit;x.Q6J("value",e)("checked",e.checked),x.xp6(1),x.hij(" ",e.name," ")}}function R(e,t){if(1&e&&(x.TgZ(0,"mat-radio-group",20),x.YNc(1,Q,2,3,"mat-radio-button",21),x.qZA()),2&e){const e=x.oxw().$implicit;x.xp6(1),x.Q6J("ngForOf",e.employeeList)}}function $(e,t){1&e&&(x.TgZ(0,"li"),x.TgZ(1,"span",23),x._uU(2," -- "),x.qZA(),x.qZA())}function j(e,t){if(1&e&&(x.TgZ(0,"ul",16),x.TgZ(1,"li"),x._uU(2),x.qZA(),x.YNc(3,R,2,1,"mat-radio-group",18),x.YNc(4,$,3,0,"li",19),x.qZA()),2&e){const e=t.$implicit;x.xp6(2),x.Oqu(e.range),x.xp6(1),x.Q6J("ngIf",e.employeeList.length>0),x.xp6(1),x.Q6J("ngIf",0==e.employeeList.length)}}function M(e,t){if(1&e&&(x.TgZ(0,"div",9),x.TgZ(1,"label"),x._uU(2,"Select Instructor"),x.qZA(),x.TgZ(3,"div",14),x.YNc(4,j,5,3,"ul",15),x.qZA(),x.qZA()),2&e){const e=x.oxw();x.xp6(4),x.Q6J("ngForOf",e.timeArray)}}function B(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"div",9),x.TgZ(1,"div",24),x.TgZ(2,"div",25),x.TgZ(3,"button",26),x.NdJ("click",function(){return x.CHM(e),x.oxw().setStudentScheduleInfo()}),x._uU(4),x.ALo(5,"translate"),x.qZA(),x.TgZ(6,"button",27),x.NdJ("click",function(){return x.CHM(e),x.oxw().dialogRef.close()}),x._uU(7),x.ALo(8,"translate"),x.qZA(),x.qZA(),x.qZA(),x.qZA()}if(2&e){const e=x.oxw();x.xp6(3),x.Q6J("type",e.submit),x.xp6(1),x.Oqu(x.lcZ(5,3,"BUTTON.ADD-BTN")),x.xp6(3),x.Oqu(x.lcZ(8,5,"BUTTON.CANCEL-BTN"))}}let W=(()=>{class e{constructor(e,t,i,s,a){this.dialogRef=e,this.data=t,this.calendarService=i,this.fb=s,this.toastrService=a,this.showDeleteBtn=!1,this.selectable=!0,this.removable=!0,this.separatorKeysCodes=[w.K5,w.OC],this.finalArray=[],this.action=t.action,this.actionData=t.calendar,this.timeArray=t.timeData,this.getScheduleList()}ngOnInit(){if("edit"===this.action){this.dialogTitle=this.actionData.title,this.calendar=this.actionData,console.log("data.calendar============",this.calendar),this.enrollData={schedule_view:this.actionData.schedule_view,studentId:this.actionData.enrollData.student_id,enrollId:this.actionData.enrollData.id,statusId:this.actionData.statusid,scheduleDate:this.actionData.startDate};let e=[];this.calendarService.getSelectedScheduleInfoStudent(this.actionData,this.enrollData).subscribe(t=>{console.log("1111---------------",t.existingSchedule);let i=t.scheduleList;if(e=t.existingSchedule,"All"==this.actionData.schedule_view){for(let e=0;e<i.length;e++)for(let t=0;t<this.timeArray.length;t++){let s=this.zeroPad(i[e].TimeSlot,this.timeArray.length);console.log("timeSlotDt====",s),1==s[t]?(this.timeArray[t].employeeList=[],this.timeArray[t].disabled=!1,this.timeArray[t].checked=!1):(this.timeArray[t].employeeList=[],this.timeArray[t].disabled=!0,this.timeArray[t].checked=!1)}if(e.length>0){this.finalArray=[];for(let t=0;t<e.length;t++)for(let i=0;i<this.timeArray.length;i++){let s=this.zeroPad(e[t].TimeSlot,this.timeArray.length);console.log("exists----timeslot-----",s),1==s[i]?(this.timeArray[i].employeeList=[],this.timeArray[i].checked=!0,this.finalArray.push(this.timeArray[i])):(this.timeArray[i].employeeList=[],this.timeArray[i].checked=!1),console.log("this.timeArray==111111111111==",this.timeArray,this.finalArray)}}}else{for(let e=0;e<i.length;e++)for(let t=0;t<this.timeArray.length;t++)this.timeArray[t].employeeList=[],1==this.zeroPad(i[e].TimeSlot,this.timeArray.length)[t]&&this.timeArray[t].employeeList.push({id:i[e].employee_id,name:i[e].employeeName,checked:!1});if(e.length>0){this.finalArray=[];for(let t=0;t<e.length;t++)for(let i=0;i<this.timeArray.length;i++){let a=this.zeroPad(e[t].TimeSlot,this.timeArray.length);if(console.log("exists----timeslot-----",a),1==a[i]&&this.timeArray[i].employeeList.length>0)for(let r=0;r<this.timeArray[i].employeeList.length;r++)if(this.timeArray[i].employeeList[r].id==e[t].employee_id){this.timeArray[i].employeeList[r].checked=!0;var s=this.timeArray[i];s.selected=this.timeArray[i].employeeList[r],this.finalArray.push(s),console.log("existing------",this.finalArray)}else this.timeArray[i].employeeList[r].checked=!1}}}}),this.calendarForm=this.editContactForm()}}zeroPad(e,t){return e.toString().padStart(Number(t),"0")}clearSelection(){console.log("this.timeArray-----");for(let e=0;e<this.timeArray.length;e++)for(let t=0;t<this.timeArray[e].employeeList.length;t++)this.timeArray[e].employeeList[t].checked=!1}editContactForm(){return this.fb.group({id:[this.calendar.id],lead_time:[this.calendar.lead_time,[a.kI.required]],schedule_name:[this.calendar.schedule_name],schedule_view:[this.calendar.schedule_view],startDate:[this.calendar.startDate,[a.kI.required]],endDate:[this.calendar.endDate,[a.kI.required]]})}submit(){}onNoClick(){this.dialogRef.close()}setStudentScheduleInfo(){console.log("this.finalArray==========",this.finalArray);let e=[];for(let n=0;n<this.finalArray.length;n++)if(e.push(this.finalArray[n].range),this.finalArray[n].timeSlot="","All"==this.actionData.schedule_view)for(let e=0;e<this.timeArray.length;e++)this.finalArray[n].timeSlot=this.finalArray[n].timeSlot+(this.finalArray[n].range==this.timeArray[e].range?1:0);else for(let e=0;e<this.timeArray.length;e++)this.finalArray[n].timeSlot=this.finalArray[n].timeSlot+(this.finalArray[n].range==this.timeArray[e].range?1:0);var t=new Date(this.enrollData.scheduleDate),i=t.getDate()-t.getDay(),s=i+6,a=new Date(t.setDate(i)),r=new Date(t.setDate(s));console.log("firstday=====",a,r),this.calendarService.checkSessionPerWeek(this.enrollData,a,r).subscribe(t=>{"Success"==t.status?Number(t.numberOfHours)+this.finalArray.length>4?this.toastrService.warning("Per Week Only 4 hours is allowed!!!"):this.calendarService.setStudentScheduleInfo(this.finalArray,this.enrollData,e).subscribe(e=>{"Success"==e.status&&(this.toastrService.success("Scheduled Successfully!!"),this.dialogRef.close("submit"))}):this.toastrService.warning("Per Week Only 4 hours is allowed!!!")})}displayFn(e){return e&&e.name?e.name:""}instructorChange(e,t){var i=this.timeArray.filter(e=>e.range==t.range)[0];console.log("event.value========",e.value),i.selected=e.value,this.finalArray.some(e=>e.range==t.range)||this.finalArray.push(i)}changeTimeDt(e,t){console.log("---------",e,t);var i=this.timeArray.filter(e=>e.range==t.range)[0];console.log("event.value========",e),i.selected=e.value,this.finalArray=[],this.finalArray.some(e=>e.range==t.range)||this.finalArray.push(i),console.log("this.filteredTimeArray---change------",this.finalArray)}getScheduleList(){this.calendarService.getScheduleList().subscribe(e=>{this.scheduleList=e.data})}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(m.so),x.Y36(m.WI),x.Y36(C),x.Y36(a.qu),x.Y36(E._W))},e.\u0275cmp=x.Xpm({type:e,selectors:[["app-form-dialog"]],decls:24,vars:9,consts:[[1,"addContainer"],[1,"modalHeader"],[1,"editRowModal"],[1,"modalHeader","clearfix"],[1,"modal-about"],[1,"font-weight-bold","p-t-5","p-l-10","font-17"],["mat-icon-button","","aria-label","Close dialog",3,"click"],["mat-dialog-content",""],[1,"register-form","m-4",3,"formGroup"],[1,"row"],[1,"col-xl-12","col-lg-12","col-md-12","col-sm-12"],["appearance","outline",1,"example-full-width","mb-3"],["matInput","","formControlName","schedule_name","readonly",""],["class","row",4,"ngIf"],[1,"col-xl-6","col-lg-6","col-md-12","col-sm-12"],["style","list-style: none;",4,"ngFor","ngForOf"],[2,"list-style","none"],["color","primary",2,"margin","5px 0 !important",3,"checked","disabled","change"],["aria-labelledby","example-radio-group-label","style","flex-direction: row !important;","class","example-radio-group","style","margin: 5px 0 !important;",4,"ngIf"],[4,"ngIf"],["aria-labelledby","example-radio-group-label",1,"example-radio-group",2,"margin","5px 0 !important"],["class","example-margin","style","padding: 5px;margin-left: 16px;","color","primary",3,"value","checked","change",4,"ngFor","ngForOf"],["color","primary",1,"example-margin",2,"padding","5px","margin-left","16px",3,"value","checked","change"],[2,"padding","5px","margin-left","16px"],[1,"col-xl-10","col-lg-10","col-md-12","col-sm-12"],[1,"example-button-row"],["mat-raised-button","","color","primary",3,"type","click"],["mat-raised-button","","color","warn","tabindex","-1",3,"click"]],template:function(e,t){1&e&&(x.TgZ(0,"div",0),x.TgZ(1,"div",1),x.TgZ(2,"div",2),x.TgZ(3,"div",3),x.TgZ(4,"div",4),x.TgZ(5,"div",5),x._uU(6),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.TgZ(7,"button",6),x.NdJ("click",function(){return t.dialogRef.close()}),x.TgZ(8,"mat-icon"),x._uU(9,"close"),x.qZA(),x.qZA(),x.qZA(),x.TgZ(10,"div",7),x.TgZ(11,"form",8),x.TgZ(12,"div",9),x.TgZ(13,"div",10),x.TgZ(14,"mat-form-field",11),x.TgZ(15,"mat-label"),x._uU(16),x.ALo(17,"translate"),x.qZA(),x._UZ(18,"input",12),x.qZA(),x.qZA(),x.qZA(),x.YNc(19,O,3,1,"div",13),x.YNc(20,Y,5,1,"div",13),x.YNc(21,M,5,1,"div",13),x._UZ(22,"br"),x.YNc(23,B,9,7,"div",13),x.qZA(),x.qZA(),x.qZA()),2&e&&(x.xp6(6),x.hij(" Schedule ",t.dialogTitle,""),x.xp6(5),x.Q6J("formGroup",t.calendarForm),x.xp6(5),x.Oqu(x.lcZ(17,7,"SCHEDULE.LIST.SCHEDULE")),x.xp6(3),x.Q6J("ngIf","All"==t.calendar.schedule_view&&4==t.actionData.statusid),x.xp6(1),x.Q6J("ngIf","All"==t.calendar.schedule_view&&4!=t.actionData.statusid),x.xp6(1),x.Q6J("ngIf","All"!=t.calendar.schedule_view),x.xp6(2),x.Q6J("ngIf",4!=t.actionData.statusid))},directives:[u.lW,d.Hw,m.xY,a._Y,a.JL,a.sg,l.KE,l.hX,o.Nt,a.Fj,a.JJ,a.u,s.O5,s.sg,P.U0,P.VQ],pipes:[F.X$],styles:[""]}),e})();class H{constructor(e){this.id=e.id||this.getRandomID(),this.lead_time=e.lead_time||"",this.schedule_name=e.schedule_name||"",this.schedule_owner=e.schedule_owner||"",this.schedule_view=e.schedule_view||"",this.schedule_view_assignment=e.schedule_view_assignment||"",this.startDate=(0,s.p6)(new Date,"yyyy-MM-dd","en")||"",this.endDate=(0,s.p6)(new Date,"yyyy-MM-dd","en")||""}getRandomID(){const e=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return e()+e()}}var z=i(60352),X=i(79961),G=i(87064),V=i(11757);const K=["calendar"];function ee(e,t){if(1&e&&(x.TgZ(0,"mat-option",22),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.Q6J("value",e),x.xp6(1),x.hij(" ",e.nric_number," ")}}function te(e,t){if(1&e&&(x.TgZ(0,"div"),x._uU(1),x.qZA()),2&e){const e=x.oxw().$implicit;x.xp6(1),x.hij(" ",e.message," ")}}function ie(e,t){if(1&e&&(x.TgZ(0,"mat-error"),x.YNc(1,te,2,1,"div",23),x.qZA()),2&e){const e=t.$implicit,i=x.oxw();x.xp6(1),x.Q6J("ngIf",i.nric_number.hasError(e.type))}}function se(e,t){if(1&e&&(x.TgZ(0,"mat-option",22),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.Q6J("value",e),x.xp6(1),x.hij(" ",e.passport_number," ")}}function ae(e,t){if(1&e&&(x.TgZ(0,"div"),x._uU(1),x.qZA()),2&e){const e=x.oxw().$implicit;x.xp6(1),x.hij(" ",e.message," ")}}function re(e,t){if(1&e&&(x.TgZ(0,"mat-error"),x.YNc(1,ae,2,1,"div",23),x.qZA()),2&e){const e=t.$implicit,i=x.oxw();x.xp6(1),x.Q6J("ngIf",i.passport_number.hasError(e.type))}}function ne(e,t){if(1&e&&(x.TgZ(0,"mat-option",22),x._uU(1),x.qZA()),2&e){const e=t.$implicit;x.Q6J("value",e),x.xp6(1),x.hij(" ",e.enrollment_no," ")}}function le(e,t){if(1&e&&(x.TgZ(0,"div"),x._uU(1),x.qZA()),2&e){const e=x.oxw().$implicit;x.xp6(1),x.hij(" ",e.message," ")}}function oe(e,t){if(1&e&&(x.TgZ(0,"mat-error"),x.YNc(1,le,2,1,"div",23),x.qZA()),2&e){const e=t.$implicit,i=x.oxw(2);x.xp6(1),x.Q6J("ngIf",i.enrollment_no.hasError(e.type))}}function ce(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"div",11),x.TgZ(1,"mat-form-field",12),x.TgZ(2,"mat-label"),x._uU(3),x.ALo(4,"translate"),x.qZA(),x._UZ(5,"input",13),x.TgZ(6,"mat-autocomplete",14,24),x.NdJ("optionSelected",function(t){return x.CHM(e),x.oxw().getStudentSchedulePerEnroll(t)}),x.YNc(8,ne,2,2,"mat-option",16),x.ALo(9,"async"),x.qZA(),x.YNc(10,oe,2,1,"mat-error",17),x.qZA(),x.qZA()}if(2&e){const e=x.MAs(7),t=x.oxw();x.xp6(3),x.Oqu(x.lcZ(4,6,"SCHEDULE.TRANSACTION-NUMBER")),x.xp6(2),x.Q6J("formControl",t.enrollment_no)("matAutocomplete",e),x.xp6(1),x.Q6J("displayWith",t.displayFnTransactionNumber),x.xp6(2),x.Q6J("ngForOf",x.lcZ(9,8,t.tranNumberList)),x.xp6(2),x.Q6J("ngForOf",t.validation_msgs.enrollment_no)}}function ue(e,t){if(1&e&&(x.TgZ(0,"div",25),x._UZ(1,"div",26),x.TgZ(2,"div",27),x.TgZ(3,"h5",28),x._uU(4,"License Class : "),x.qZA(),x.qZA(),x.TgZ(5,"div",29),x.TgZ(6,"b",30),x._uU(7),x.qZA(),x.qZA(),x.qZA()),2&e){const e=x.oxw();x.xp6(7),x.Oqu(e.LicenseData)}}function de(e,t){if(1&e){const e=x.EpF();x.TgZ(0,"div",8),x.TgZ(1,"p",31),x._uU(2,"Please Make Payment for "),x.TgZ(3,"b"),x._uU(4),x.qZA(),x._uU(5," to proceed further"),x.qZA(),x.TgZ(6,"div",32),x.TgZ(7,"button",33),x.NdJ("click",function(){return x.CHM(e),x.oxw().setPaymentDetails()}),x._uU(8),x.ALo(9,"translate"),x.qZA(),x.qZA(),x.qZA()}if(2&e){const e=x.oxw();x.xp6(4),x.Oqu(e.upcomingStatus.status),x.xp6(3),x.Q6J("type",e.submit),x.xp6(1),x.Oqu(x.lcZ(9,3,"BUTTON.PAYMENT"))}}function he(e,t){if(1&e&&(x.TgZ(0,"div",8),x.TgZ(1,"div",34),x._UZ(2,"full-calendar",35),x.qZA(),x.qZA()),2&e){const e=x.oxw();x.xp6(2),x.Q6J("options",e.calendarOptions)}}function me(e,t){1&e&&(x.TgZ(0,"div",8),x.TgZ(1,"div",32),x.TgZ(2,"p"),x._uU(3,"No Schedule Available"),x.qZA(),x.qZA(),x.qZA())}function pe(e,t){1&e&&(x.TgZ(0,"div",8),x.TgZ(1,"div",32),x.TgZ(2,"p"),x._uU(3,"Waiting For LDL Status!!. Please Update the LDL Status"),x.qZA(),x.qZA(),x.qZA())}const ge=[{path:"schedule-list",component:(()=>{class e extends z.n{constructor(e,t,i,s,r){super(),this.fb=e,this.dialog=t,this.calendarService=i,this.snackBar=s,this.toastrService=r,this.filterOptions="All",this.calendarData=[],this.filterItems=[],this.LicenseData=[],this.showEnroll=!1,this.nric_number=new a.NI("",{validators:[e=>"string"==typeof e.value?{invalidAutocompleteObject:{value:e.value}}:null]}),this.passport_number=new a.NI("",{validators:[e=>"string"==typeof e.value?{invalidAutocompleteObject:{value:e.value}}:null]}),this.enrollment_no=new a.NI("",{validators:[e=>"string"==typeof e.value?{invalidAutocompleteObject:{value:e.value}}:null]}),this.validation_msgs={nric_number:[{type:"invalidAutocompleteObject",message:"NRIC Number not recognized. Click one of the options."}],passport_number:[{type:"invalidAutocompleteObject",message:"Passport Number not recognized. Click one of the options."}],enrollment_no:[{type:"invalidAutocompleteObject",message:"Transaction Number not recognized. Click one of the options."}]},this.calendarOptions={headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:"dayGridMonth",displayEventTime:!1,weekends:!0,editable:!0,selectMirror:!0,dayMaxEvents:!0,eventClick:this.handleEventClick.bind(this),eventsSet:this.handleEvents.bind(this)},this.dialogTitle="Add New Event",this.calendar=new H({}),this.addCusForm=this.createCalendarForm(this.calendar),this.getScheduleList()}ngOnInit(){this.getNRICNumberForStudentSchedule(),this.getPassportNumberForStudentSchedule(),this.loadStripe(),this.getTimeDetails()}getNRICNumberForStudentSchedule(){this.calendarService.getNRICNumberForStudentSchedule().subscribe(e=>{this.nricNumberData=e,this.nricNumberList=this.nric_number.valueChanges.pipe((0,T.O)(""),(0,D.U)(e=>"string"==typeof e?e:e.nric_number),(0,D.U)(e=>e?this._filterNricNumber(e):this.nricNumberData.slice()))})}getPassportNumberForStudentSchedule(){this.calendarService.getPassportNumberForStudentSchedule().subscribe(e=>{this.passportNumberData=e,this.passportNumberList=this.passport_number.valueChanges.pipe((0,T.O)(""),(0,D.U)(e=>"string"==typeof e?e:e.passport_number),(0,D.U)(e=>e?this._filterPassportNumber(e):this.passportNumberData.slice()))})}getScheduleList(){this.calendarService.getScheduleList().subscribe(e=>{this.scheduleList=e.data;for(let t=0;t<this.scheduleList.length;t++)this.scheduleList[t].checked=!0,this.filterItems.push(this.scheduleList[t].status)})}displayFnNRICNUmber(e){return e&&e.nric_number?e.nric_number:""}displayFnPassportNumber(e){return e&&e.passport_number?e.passport_number:""}displayFnTransactionNumber(e){return console.log("user===",e),e&&e.enrollment_no?e.enrollment_no:""}_filterNricNumber(e){const t=e.toLowerCase();return this.nricNumberData.filter(e=>e.nric_number.toLowerCase().includes(t))}_filterPassportNumber(e){const t=e.toLowerCase();return this.passportNumberData.filter(e=>e.passport_number.toLowerCase().includes(t))}_filterTranNumber(e){const t=e.toLowerCase();return this.tranNumberData.filter(e=>e.enrollment_no.toLowerCase().includes(t))}changeCategory(e,t){e.checked?this.filterItems.push(t.status):this.filterItems.splice(this.filterItems.indexOf(t.status),1),this.filterEvent(this.filterItems)}filterEvent(e){const t=this.calendarEvents.filter(t=>e.map(e=>e).includes(t.title));this.calendarOptions.events=t}handleEventClick(e){this.eventClick(e)}eventClick(e){const t={id:e.event.id,title:e.event.title,lead_time:e.event._def.extendedProps.lead_time,statusid:e.event._def.extendedProps.statusid,schedule_name:e.event._def.extendedProps.schedule_name,schedule_view:e.event._def.extendedProps.schedule_view,schedule_view_assignment:e.event._def.extendedProps.employeeName,startDate:e.event.start,endDate:e.event.end,enrollData:this.enrollDetails};let i;i="true"===localStorage.getItem("isRtl")?"rtl":"ltr";const s=this.dialog.open(W,{data:{calendar:t,timeData:this.timeArray,action:"edit"},direction:i});this.subs.sink=s.afterClosed().subscribe(e=>{"submit"===e&&this.addCusForm.reset()})}editEvent(e,t){const i=this.calendarEvents.slice(),s=Object.assign({},i[e]);s.id=t.id,s.title=t.title,s.start=t.startDate,s.end=t.endDate,s.className="",s.groupId=t.category,s.details=t.details,i[e]=s,this.calendarEvents=i,this.calendarOptions.events=i}handleEvents(e){}createCalendarForm(e){return this.fb.group({id:[e.id],lead_time:[e.lead_time,[a.kI.required,a.kI.pattern("[a-zA-Z]+([a-zA-Z ]+)*")]],schedule_name:[e.schedule_name],schedule_view:[e.schedule_view],startDate:[e.startDate,[a.kI.required]],endDate:[e.endDate,[a.kI.required]]})}showNotification(e,t,i,s){this.snackBar.open(t,"",{duration:2e3,verticalPosition:i,horizontalPosition:s,panelClass:e})}selectedNricNumber(e){this.enrollDetails=[],e.option.value.id&&(this.passport_number.setValue(""),this.calendarService.getEnrollmentNumberForSchedule(e.option.value.id).subscribe(e=>{e.enrollData.length>0?(this.showEnroll=!0,this.tranNumberData=e.enrollData,this.tranNumberList=this.enrollment_no.valueChanges.pipe((0,T.O)(""),(0,D.U)(e=>"string"==typeof e?e:e.enrollment_no),(0,D.U)(e=>e?this._filterTranNumber(e):this.tranNumberData.slice()))):(this.showEnroll=!1,this.toastrService.warning("No Enrollment Number Available"))}))}loadStripe(){if(!window.document.getElementById("stripe-script")){var e=window.document.createElement("script");e.id="stripe-script",e.type="text/javascript",e.src="https://checkout.stripe.com/checkout.js",e.onload=()=>{this.handler=window.StripeCheckout.configure({key:"pk_test_aeUUjYYcx4XNfKVW60pmHTtI",locale:"auto",token:function(e){console.log(e),alert("Payment Success!!")}})},window.document.body.appendChild(e)}}selectedPassportNumber(e){this.enrollDetails=[],e.option.value.id&&(this.nric_number.setValue(""),this.calendarService.getEnrollmentNumberForSchedule(e.option.value.id).subscribe(e=>{e.enrollData.length>0?(this.showEnroll=!0,this.tranNumberData=e.enrollData,this.tranNumberList=this.enrollment_no.valueChanges.pipe((0,T.O)(""),(0,D.U)(e=>"string"==typeof e?e:e.enrollment_no),(0,D.U)(e=>e?this._filterTranNumber(e):this.tranNumberData.slice()))):(this.showEnroll=!1,this.toastrService.warning("No Enrollment Number Available"))}))}showSchedule(e){this.calendarService.getStudentSchedulePerEnroll(e).subscribe(e=>{console.log("res============",e),this.calendarData=[],this.enrollDetails=this.enrollment_no.value;for(let t=0;t<e.scheduleList.length;t++)this.calendarData.push({title:e.scheduleList[t].status,start:new Date(e.scheduleList[t].startDate),end:new Date(e.scheduleList[t].endDate),className:e.scheduleList[t].schedule_color,id:e.scheduleList[t].id,statusid:e.scheduleList[t].status_id,schedule_name:e.scheduleList[t].status,schedule_view:e.scheduleList[t].schedule_view,assignment:e.scheduleList[t].AssignmentList,startDate:new Date(e.scheduleList[t].startDate),endDate:new Date(e.scheduleList[t].endDate),employeeName:e.scheduleList[t].employee_name});this.calendarEvents=this.calendarData,this.tempEvents=this.calendarEvents,this.calendarOptions.events=this.calendarEvents})}getStudentSchedulePerEnroll(e){this.LicenseData=[],console.log("event.option.value---===========getStudentSchedule==========--",e.option.value),this.calendarService.checkPaymentDone(e.option.value).subscribe(t=>{console.log("res----------",t);let i=t.LicenseData;this.amountToBePaid=t.amountToBePaid,this.upcomingStatus=t.nextStatus[0],console.log("licenseinfo-------------",this.upcomingStatus);for(let e=0;e<i.length;e++)this.LicenseData.push(i[e].license_class);"Success"==t.status?7==this.upcomingStatus.id?this.scheduleStatus="Waiting":(this.scheduleStatus="Success",this.showSchedule(e.option.value)):"Pay"==t.status&&(this.scheduleStatus="Pay")})}setPaymentDetails(){console.log("enrollment_no====",this.enrollment_no.value),window.StripeCheckout.configure({key:"pk_test_aeUUjYYcx4XNfKVW60pmHTtI",locale:"auto",token:e=>{this.calendarService.setPaymentDetails(this.enrollment_no.value,this.amountToBePaid).subscribe(e=>{"Success"==e.status?(this.toastrService.success("Payment Done!!"),this.scheduleStatus="Success",this.showSchedule(this.enrollment_no.value)):(this.scheduleStatus="Pay",this.toastrService.success("Payment Failed, Please try again!!"))})}}).open({name:"Demo Site",description:"2 widgets",amount:100*this.amountToBePaid})}getTimeDetails(){this.calendarService.getTimeDetails().subscribe(e=>{let t=e.data[0];this.makeTimeIntervals(t.working_hour_from.substr(0,5),t.working_hour_to.substr(0,5),60,t.rest_hour_from.substr(0,5),t.rest_hour_to.substr(0,5))})}makeTimeIntervals(e,t,i,s,a){e=e.toString().split(":"),t=t.toString().split(":"),i=parseInt(i,10);var r=function(e){return e<10?"0"+e.toString():e},n=parseInt(e[0],10),l=parseInt(e[1],10),o=parseInt(t[0],10),c=(parseInt(t[1],10),n),u=l,d=c+":"+r(u),h="",m=[];do{((u+=i)%60==0||u>60)&&(u=60===u?0:u-60,c+=1),h=c+":"+r(u),m.push({range:d+" - "+h,checkValue:0,employeeList:[]}),d=h}while(c!==o);var p=s+" - "+a;this.timeArray=m.filter(e=>e.range!=p)}}return e.\u0275fac=function(t){return new(t||e)(x.Y36(a.qu),x.Y36(m.uw),x.Y36(C),x.Y36(c.ux),x.Y36(E._W))},e.\u0275cmp=x.Xpm({type:e,selectors:[["app-add-schedule"]],viewQuery:function(e,t){if(1&e&&x.Gf(K,5),2&e){let e;x.iGM(e=x.CRH())&&(t.calendar=e.first)}},features:[x.qOj],decls:43,vars:29,consts:[[1,"content"],[1,"container-fluid"],[1,"block-header"],[1,"row"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12"],[1,"breadcrumb","breadcrumb-style"],[1,"breadcrumb-item"],[1,"page-title"],[1,"col-md-12","col-sm-12"],[1,"card"],[1,"card-body"],[1,"col-xl-4","col-lg-4","col-md-12","col-sm-12","mb-2"],["appearance","outline",1,"example-full-width","mb-3"],["type","text","matInput","",3,"formControl","matAutocomplete"],[3,"displayWith","optionSelected"],["autoNric","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["autoPassport","matAutocomplete"],["class","col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-2",4,"ngIf"],["class","row","style","text-align: center;padding: 10px;",4,"ngIf"],["class","col-md-12 col-sm-12",4,"ngIf"],[3,"value"],[4,"ngIf"],["autoTran","matAutocomplete"],[1,"row",2,"text-align","center","padding","10px"],[1,"col-md-2"],[1,"col-md-3"],[2,"float","right"],[1,"col-md-7"],[2,"float","left"],[2,"text-align","center"],[1,"panel-body",2,"text-align","center"],["mat-raised-button","","color","primary",3,"type","click"],[1,"panel-body"],[3,"options"]],template:function(e,t){if(1&e&&(x.TgZ(0,"section",0),x.TgZ(1,"div",1),x.TgZ(2,"div",2),x.TgZ(3,"div",3),x.TgZ(4,"div",4),x.TgZ(5,"ul",5),x.TgZ(6,"li",6),x.TgZ(7,"h4",7),x._uU(8),x.ALo(9,"translate"),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.TgZ(10,"div",3),x.TgZ(11,"div",8),x.TgZ(12,"div",9),x.TgZ(13,"div",10),x.TgZ(14,"div",3),x.TgZ(15,"div",11),x.TgZ(16,"mat-form-field",12),x.TgZ(17,"mat-label"),x._uU(18),x.ALo(19,"translate"),x.qZA(),x._UZ(20,"input",13),x.TgZ(21,"mat-autocomplete",14,15),x.NdJ("optionSelected",function(e){return t.selectedNricNumber(e)}),x.YNc(23,ee,2,2,"mat-option",16),x.ALo(24,"async"),x.qZA(),x.YNc(25,ie,2,1,"mat-error",17),x.qZA(),x.qZA(),x.TgZ(26,"div",11),x.TgZ(27,"mat-form-field",12),x.TgZ(28,"mat-label"),x._uU(29),x.ALo(30,"translate"),x.qZA(),x._UZ(31,"input",13),x.TgZ(32,"mat-autocomplete",14,18),x.NdJ("optionSelected",function(e){return t.selectedPassportNumber(e)}),x.YNc(34,se,2,2,"mat-option",16),x.ALo(35,"async"),x.qZA(),x.YNc(36,re,2,1,"mat-error",17),x.qZA(),x.qZA(),x.YNc(37,ce,11,10,"div",19),x.qZA(),x.YNc(38,ue,8,1,"div",20),x.YNc(39,de,10,5,"div",21),x.YNc(40,he,3,1,"div",21),x.YNc(41,me,4,0,"div",21),x.YNc(42,pe,4,0,"div",21),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.qZA(),x.qZA()),2&e){const e=x.MAs(22),i=x.MAs(33);x.xp6(8),x.Oqu(x.lcZ(9,19,"SCHEDULE.STUD-TITLE")),x.xp6(10),x.Oqu(x.lcZ(19,21,"SELECT-LICENSE.LIST.NRIC-NUMBER")),x.xp6(2),x.Q6J("formControl",t.nric_number)("matAutocomplete",e),x.xp6(1),x.Q6J("displayWith",t.displayFnNRICNUmber),x.xp6(2),x.Q6J("ngForOf",x.lcZ(24,23,t.nricNumberList)),x.xp6(2),x.Q6J("ngForOf",t.validation_msgs.nric_number),x.xp6(4),x.Oqu(x.lcZ(30,25,"SELECT-LICENSE.LIST.PASSPORT-NUMBER")),x.xp6(2),x.Q6J("formControl",t.passport_number)("matAutocomplete",i),x.xp6(1),x.Q6J("displayWith",t.displayFnPassportNumber),x.xp6(2),x.Q6J("ngForOf",x.lcZ(35,27,t.passportNumberList)),x.xp6(2),x.Q6J("ngForOf",t.validation_msgs.passport_number),x.xp6(1),x.Q6J("ngIf",t.showEnroll),x.xp6(1),x.Q6J("ngIf",t.LicenseData.length>0),x.xp6(1),x.Q6J("ngIf","Pay"==t.scheduleStatus),x.xp6(1),x.Q6J("ngIf",t.calendarData.length>0),x.xp6(1),x.Q6J("ngIf",0==t.calendarData.length&&"Success"==t.scheduleStatus),x.xp6(1),x.Q6J("ngIf",0==t.calendarData.length&&"Waiting"==t.scheduleStatus)}},directives:[l.KE,l.hX,o.Nt,a.Fj,X.ZL,a.JJ,a.oH,X.XC,s.sg,s.O5,G.ey,l.TO,u.lW,V.woE],pipes:[F.X$,s.Ov],styles:[""]}),e})()}];let fe=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=x.oAB({type:e}),e.\u0275inj=x.cJS({imports:[[N.Bz.forChild(ge)],N.Bz]}),e})();var ve=i(46739),Ae=i(17647),be=i(95522),ye=i(37192),Ze=i(279),Se=i(9451),_e=i(85256),Ne=i(52352),Te=i(31269);V.z1U.registerPlugins([Ze.ZP,Se.ZP,_e.Z,Ne.ZP]);let De=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=x.oAB({type:e}),e.\u0275inj=x.cJS({providers:[C],imports:[[Ae.xD,be.Hi,ve.d,s.ez,a.u5,a.UX,r.p0,n.TU,l.lN,o.c,c.ZX,u.ot,d.Ps,m.Is,p.JX,g.g0,h.LD,f.FA,v.p9,b.Nh,y.Tx,P.Fk,A.Ad,fe,Z.Cq,S.T5,_.yI,F.aw,X.Bb,V.z1U,ye.Ll,ye.x,Te.ef]]}),e})()}}]);